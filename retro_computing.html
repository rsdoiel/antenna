<!doctype html>
<html lang="en-US">
<head>
  <meta charset="utf-8" >
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes" >
  <title>retro computing 2024.29</title>
<!--  <link rel="stylesheet" type="text/css"  href="webfonts/fonts.css" media="screen" > -->
  <link rel="stylesheet" type="text/css"  href="css/site.css" media="screen" >
</head>
<body>
<header>
	<img class="logo" 
		src="https://upload.wikimedia.org/wikipedia/commons/9/9c/Antenna_1_-_The_Noun_Project.svg"
		alt="line art showing an antenna"
		height="80" width="60" >
	<h1>The Antenna</h1> 
	<h2>finding signal in the noise</h2>
</header>
<nav>
<ul>
	<li><a href="./">The Antenna</a></li>
	<li><a href="snapshots/" title="Somedays daily">Snapshots</a></li>
	<li><a href="archives/">Archives</a></li>
	<li><a href="search.html">Search</a></li>
	<li><a href="about.html">About</a></li>
</ul>
</nav>
<section>
<div class="description-for-items">
Items collected from feeds in <a href="retro_computing.txt">retro_computing.txt</a>
</div>
<h1 id="retro-computing-2024.29">retro computing 2024.29</h1>
<p>(date: 2024-07-19 07:54:37)</p>
<hr />
<h2 id="icon-bars-cloak-of-invisibility-improved-in-pinboard-2.05">Icon
bar’s cloak of invisibility improved in Pinboard 2.05</h2>
<p>date: 2024-07-19, from: RiscOS Story</p>
<p>A new version of Pinboard 2 has been released by RISC OS
Developments. The software is a replacement for the standard ‘Pinboard’
supplied with the operating system – the component that looks after the
desktop background, allowing backdrops to be displayed, icons to be
pinned to it to save navigating to the relevant files or applications
using the filer, and so on – and provides quite a number of new features
that make it a worthy replacement. For example, as well as pinning icons
to the desktop, Pinboard 2 allows…</p>
<p><a
href="https://www.riscository.com/2024/icon-bar-improved-transparency-pinboard-2-05/"
class="uri">https://www.riscository.com/2024/icon-bar-improved-transparency-pinboard-2-05/</a></p>
<hr />
<h2 id="kpdfutil-1.06-released">KPDFUtil 1.06 released</h2>
<p>date: 2024-07-19, from: RiscOS Story</p>
<p>KPDFUtil is an application from Kevin Wells that provides a front-end
to the facilities found in PDFUtils, itself a set of command line
utilities for getting information about PDF documents, and performing
actions on them such as extracting individual pages, converting them to
HTML, and so on. Kevin’s application presents a main window with the
various possible actions in a series of buttons, and version 1.06 adds a
menu over the main window as another method of accessing those actions.
If you find any of Kevin’s software, why not consider…</p>
<p><a href="https://www.riscository.com/2024/kpdfutil-1-06-released/"
class="uri">https://www.riscository.com/2024/kpdfutil-1-06-released/</a></p>
<hr />
<h2 id="kernel-6.10-available-for-general-usage">Kernel 6.10 Available
for General Usage</h2>
<p>date: 2024-07-17, from: Linux Magazine</p>
<p>
Linus Torvalds has released the 6.10 kernel and it includes significant
performance increases for Intel Core hybrid systems and more.
</p>
<p><a
href="http://www.linux-magazine.com/Online/News/Kernel-6.10-Available-for-General-Usage"
class="uri">http://www.linux-magazine.com/Online/News/Kernel-6.10-Available-for-General-Usage</a></p>
<hr />
<h2 id="b.log-20240716---seashell-tutorial.">b.log 2024/07/16 - SeaShell
tutorial.</h2>
<p>date: 2024-07-16, from: Richard Murray’s blog</p>
<p>SeaShell tutorial.</p>
<p><a href="https://heyrick.eu/blog/index.php?diary=20240716"
class="uri">https://heyrick.eu/blog/index.php?diary=20240716</a></p>
<hr />
<h2 id="vote-for-the-july-2004-plus-post-topic">Vote for the July 2004
Plus Post Topic</h2>
<p>date: 2024-07-16, from: Computer ads from the Past</p>
<p>If you are a paid subscriber, voting is open for one week for this
month’s topic</p>
<p><a
href="https://computeradsfromthepast.substack.com/p/vote-for-the-july-2004-plus-post"
class="uri">https://computeradsfromthepast.substack.com/p/vote-for-the-july-2004-plus-post</a></p>
<hr />
<h2 id="rougol-talk-july-2024---nathan-atkinson">Rougol Talk July 2024 -
Nathan Atkinson</h2>
<p>date: 2024-07-16, from: Icon Bar, RISC OS News</p>
<p>The July 2024 talk was a hybrid meeting featuring Nathan Atkinson
talking about the coding group Visions of the Impossible and his general
RISC OS experiences.</p>
<p><a href="http://www.iconbar.com/comments/rss/news2084.html"
class="uri">http://www.iconbar.com/comments/rss/news2084.html</a></p>
<hr />
<h2
id="tuxedo-computers-releases-infinitybook-pro-14-gen9-laptop">TUXEDO
Computers Releases InfinityBook Pro 14 Gen9 Laptop</h2>
<p>date: 2024-07-15, from: Linux Magazine</p>
<p>
Sporting either AMD or Intel CPUs, the TUXEDO InfinityBook Pro 14 is an
extremely compact, lightweight, sturdy powerhouse.
</p>
<p><a
href="http://www.linux-magazine.com/Online/News/TUXEDO-Computers-Releases-InfinityBook-Pro-14-Gen9-Laptop"
class="uri">http://www.linux-magazine.com/Online/News/TUXEDO-Computers-Releases-InfinityBook-Pro-14-Gen9-Laptop</a></p>
<hr />
<h2 id="pinboard-2.05-released">PinBoard 2.05 released</h2>
<p>date: 2024-07-15, from: Icon Bar, RISC OS News</p>
<p>At TIB, we have been following the developments of PinBoard
closely…</p>
<p><a href="http://www.iconbar.com/comments/rss/news2083.html"
class="uri">http://www.iconbar.com/comments/rss/news2083.html</a></p>
<hr />
<h2
id="b.log-20240714---seashell-trumps-assassination-time-for-biden-to-leave.">b.log
2024/07/14 - SeaShell, Trump’s assassination, Time for Biden to
leave.</h2>
<p>date: 2024-07-14, from: Richard Murray’s blog</p>
<p>SeaShell, Trump’s assassination, Time for Biden to leave.</p>
<p><a href="https://heyrick.eu/blog/index.php?diary=20240714"
class="uri">https://heyrick.eu/blog/index.php?diary=20240714</a></p>
<hr />
<h2
id="pretty-pictures-bootable-floppy-disks-and-the-first-canon-cat-demo">Pretty
pictures, bootable floppy disks, and the first Canon Cat demo?</h2>
<p>date: 2024-07-14, from: Old Ventage Computing Research</p>
Now that <a href="/2024/05/refurb-weekend-canon-cat.html">our 1987 Canon
Cat is refurbished</a> and ready to go another nine innings or so, it’s
time to get into the operating system and pull some tricks.
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhK60EsQvMeI4kg_umqqJHawE44Nu7a98VjFOFJzUhGdcYVLbj1GoERoDtkTsz63rzEhwGP5y-4hmdTyc2eGl0xj3p0VA_2zrQehjJpt96jH82PCqItsaLOq-6_Uxt9s8pqJ4wfd35z21Ib8oXa7r5FO9iMUH7CkBKAX6YnxjnVAXYIX8VhYIlesfKq23U/s4080/PXL_20240518_235223735%20%281%29.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" height="320" data-original-height="4080" data-original-width="3072" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhK60EsQvMeI4kg_umqqJHawE44Nu7a98VjFOFJzUhGdcYVLbj1GoERoDtkTsz63rzEhwGP5y-4hmdTyc2eGl0xj3p0VA_2zrQehjJpt96jH82PCqItsaLOq-6_Uxt9s8pqJ4wfd35z21Ib8oXa7r5FO9iMUH7CkBKAX6YnxjnVAXYIX8VhYIlesfKq23U/s320/PXL_20240518_235223735%20%281%29.jpg"/></a>
</div>
As you’ll recall <a href="/2024/05/refurb-weekend-canon-cat.html">from
our historical discussion of the Canon Cat</a>, the Cat was designed by
Jef Raskin as a sophisticated user-centric computer but demoted to
office machine within Canon’s typewriter division, which was tasked with
selling it. Because Canon only ever billed the Cat as a “work processor”
for documents and communications, and then abruptly tanked it after just
six months, it never had any software packages that were commercially
produced. In fact, I can’t find <em>any</em> software written for it
other than the original Tutor and Demo diskettes included with the
system and a couple of
<a href="https://randoc.wordpress.com/2020/02/23/a-few-remarks-on-the-canon-cat/">Canon-specific
utilities</a>, which I don’t have and don’t seem to be imaged anywhere.
<p>
So this entry will cover a lot of ground: first, we have to be able to
reliably read, image and write Canon disks on another system, then
decipher the format, and <em>then</em> patch those images to display
pictures and automatically run arbitrary code. At the end we’ll have
three examples we can image on any PC 3.5” floppy drive and insert into
a Cat, turn it on or hit DISK, and have the Cat automatically run: a Jef
Raskin “picture disk,” a simple but useful dummy terminal, and the
world’s first (I believe) Canon Cat, two-disk, slightly animated and
finely dithered, slideshow graphics demo!
<p>
But before we get to pumping out floppy disks, we first need to talk
about how one uses a Cat. And that means we need to talk a bit about
Forth, the Canon Cat’s native tongue. And that means we should probably
talk more about the operating system too. Oh, and we should go down to
CompUSA and buy a brand new floppy drive while we’re at it.
<p>
<p><a name='more'></a></p>
For those of you without a Cat, which sadly will be most of you, at
least a little of this entry can be done in MAME, which is at present
the sole extant Cat emulator. (A Wasm version with ROMs ready to go is
<a href="https://archive.org/details/canoncat">at the Internet
Archive</a>, though here I’ll be running it on my Raptor Talos II in
Fedora.) Unfortunately MAME emulates neither the internal disk drive nor
the serial port, so you won’t be able to run these demos on it yet, and
there’s a couple glitches we need to work around, but this will still
give you a flavour of the machine and let you poke around a bit.
<p>
Everything in this entry assumes the production v1.74 ROMs, which were
to the best of my knowledge the only version mass-produced Cats were
ever officially shipped with. Source code and binaries for v2.40 ROMs
exist but my Cat doesn’t run them. If you want to run the v2.40 ROMs
anyway, don’t be surprised if some of this doesn’t work right, and I’m
very sure the demos won’t.
<p>
<p>The major glitches to rectify are the emulator freezing when the
beeper is triggered (probably incomplete emulation of one of the custom
Canon gate array chips) and switching the keyboard layout so we can type
angle brackets (unpossible with the default US layout, also true of a
real Cat). Let’s fix those issues first.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQcKPRxvDra2lAbiW7ZTljGjzEciLw_3bbkGTT4frQzH6HHhOGNjmICGuOA6Bk_LfeJV0_hl4J45TszFdx2uY7GWRWf_L42cKceAjdjXo2EcMUlDptGTVZ1n4XnJI32s09Nfb956W0wb3fCGcDnJaO3o0MvbIRvgUpcZG-GL2ualGo2jFr-HAZSOjsUiM/s672/0000.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiQcKPRxvDra2lAbiW7ZTljGjzEciLw_3bbkGTT4frQzH6HHhOGNjmICGuOA6Bk_LfeJV0_hl4J45TszFdx2uY7GWRWf_L42cKceAjdjXo2EcMUlDptGTVZ1n4XnJI32s09Nfb956W0wb3fCGcDnJaO3o0MvbIRvgUpcZG-GL2ualGo2jFr-HAZSOjsUiM/s320/0000.png"/></a>
</div>
<p>The default screen after power on. This is where you would enter a
document, which we’ll get to in a second. These MAME grabs (captured at
the system’s raw 672x344 screen resolution) have been corrected for
aspect ratio so that they’ll look approximately the same as they would
on the Cat’s CRT display.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSTNs06d9T2SUV_Gl1gNUxGuboKlA5Wd3GiNJk5ursvhPWlT94t9xobDG1p1eu5wVmsvZxGDgKeKsczDuFUs3bimNU3L02efnnVXk1Dm9ZK5NSJDThrkB3fd3M6_ZARDWRauU_411PRTSpBqjhM-9GB5Rhihf9YYNz9SGFVna-eNxstRiiaTMu3VnSyEk/s4080/PXL_20240527_154704116.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgSTNs06d9T2SUV_Gl1gNUxGuboKlA5Wd3GiNJk5ursvhPWlT94t9xobDG1p1eu5wVmsvZxGDgKeKsczDuFUs3bimNU3L02efnnVXk1Dm9ZK5NSJDThrkB3fd3M6_ZARDWRauU_411PRTSpBqjhM-9GB5Rhihf9YYNz9SGFVna-eNxstRiiaTMu3VnSyEk/s320/PXL_20240527_154704116.jpg"/></a>
</div>
<p>The Cat’s interface is entirely keyboard-driven with no mouse,
joystick or even cursor keys. To perform special functions, the USE
FRONT key acts like a Command or Control key when combined with others.
Here, we’ll enter the setup menu by holding down USE FRONT (in the
default MAME key layout, this is probably Control) and pressing SETUP,
which is usually the left brace key. <em>Keep USE FRONT/Control
depressed after you release the SETUP key.</em></p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQTAKBF2yEMV1-iIfEtfMQMoM0LOF5KGXof1O425fymR9Uj9wPO3qIOvUfHjrYMrJN90zGQ8MWDD2_vzmGDLCsA46uvuWfZiGmtADGJPutXtEPjAnFWsHyfqWFEBrk-fgpxVj3LquKCMgJW-6gmGmcNsHYOg5orPSL6r9AeaQxa06ya9yV24_FDEWWzXI/s672/0001.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQTAKBF2yEMV1-iIfEtfMQMoM0LOF5KGXof1O425fymR9Uj9wPO3qIOvUfHjrYMrJN90zGQ8MWDD2_vzmGDLCsA46uvuWfZiGmtADGJPutXtEPjAnFWsHyfqWFEBrk-fgpxVj3LquKCMgJW-6gmGmcNsHYOg5orPSL6r9AeaQxa06ya9yV24_FDEWWzXI/s320/0001.png"/></a>
</div>
<p>The first setup screen then appears. With USE FRONT/Control still
down, tap SETUP/left brace again for the second screen. <em>Do not
release USE FRONT/Control yet.</em></p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguMXdJr4atfz5kajIgxT4z_2fCTswtfEmir6qMvwcBXTwL1AJKGzeQCuBY5b2W7MZ-Dya6lhpt_yJtt0ryuA-cB-Y3UJ5JvJIbJvKJW8vGyQivr60NtlYz_5RO6l3zl_zxN9DJ7VCUhyphenhyphend3Dlaah47YHeGlinMUyLBsqRgv86WJPEPeFgFhbabP9Zkc17c/s672/0002.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEguMXdJr4atfz5kajIgxT4z_2fCTswtfEmir6qMvwcBXTwL1AJKGzeQCuBY5b2W7MZ-Dya6lhpt_yJtt0ryuA-cB-Y3UJ5JvJIbJvKJW8vGyQivr60NtlYz_5RO6l3zl_zxN9DJ7VCUhyphenhyphend3Dlaah47YHeGlinMUyLBsqRgv86WJPEPeFgFhbabP9Zkc17c/s320/0002.png"/></a>
</div>
The two settings we’ll want to change are the keyboard and problem
signal. The keyboard is most likely set to United States (or as
appropriate to your own locale), but we’ll need it set to true ASCII for
hacking purposes. With USE FRONT/Control still down, repeatedly tap
either of the LEAP keys (usually mapped to Alt/Option) to cycle through
the choices until “ASCII” is shown. If you started at United States, tap
the left LEAP/Alt/Option key for Dvorak and again for ASCII, and that
should do it, but <em>do not let go of USE FRONT/Control yet.</em>
<p>
Then, to change the problem signal, <em>with USE FRONT/Control still
down</em>, tap SPACE twice to move to that, and tap LEAP until “Flash”
is shown (and only flash, none of the beep options). Your screen should
look like the grab above. Assuming it does, <em>now</em> you can let go
of USE FRONT. After a brief pause the settings will be written to the
battery-backed settings RAM and the Cat will go back to the main
document.
<p>
So that you understand what we’ll be trying to accomplish (and,
eventually, subvert), let’s have a quick look at what makes the Cat’s
interface unique.
<p>
<h3>
A tour of the Cat
</h3>
<p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgqWuF-7Zby5v8mm3zjnmilGCz6dQ5Mw0lPQmwTFyo3aSujUqQUoR-0auKNEf8hetsk8vqfGEpVTNAmoLRhnAzEjG6lc64TJKudUZiwHjWajUYCqfIrvymnYyI9soO1SQ-SZPmOQKF4MWp0OxEFsQyEDbqPvCwcd1-MVxJWbXp9eocIGeh4h_ygvMLj5S4/s672/0008.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgqWuF-7Zby5v8mm3zjnmilGCz6dQ5Mw0lPQmwTFyo3aSujUqQUoR-0auKNEf8hetsk8vqfGEpVTNAmoLRhnAzEjG6lc64TJKudUZiwHjWajUYCqfIrvymnYyI9soO1SQ-SZPmOQKF4MWp0OxEFsQyEDbqPvCwcd1-MVxJWbXp9eocIGeh4h_ygvMLj5S4/s320/0008.png"/></a>
</div>
The Cat’s operating system is entirely in ROM, so there’s no waiting to
start — though if you have a disk in the drive, and the machine
generally expects you will so that your workspace can be autosaved, it
will load when you power it on. Either way, you can start entering text
almost immediately. What looks like two cursors will track your typing,
but what they really are is the selection (inverse video) and the
insertion point (grey block). The selection is what is deleted
immediately by pressing ERASE (backspace).
<p>
<p>At the bottom of the screen is the <i>ruler</i>. This shows your
document margins and your tab stops, though in characters, not inches —
the Cat uses fixed-width, non-proportional characters. Paragraph style,
line spacing and the keyset in use (I or II, for those keys with
multiple character pairs assigned to them) are at the bottom, along with
a memory usage gauge and the current line number within the current
document.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhQTjckg5CfFguAqXpARlnSy2c6sJuu8ysVhlsfOKKWHdWEZNLewYYnKifhXGFXCiObD-7JIzFi6QlplGp98qWkGauKcyvRthra9bIEwHWa1w82g2lnrXnOFETLIhV94Vbhn9TkzGYM2LFmoRdYtGtSrfCOLVFRo0kjcj1FqKmsi1aXC3pz0YundZJx92A/s672/0009.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhQTjckg5CfFguAqXpARlnSy2c6sJuu8ysVhlsfOKKWHdWEZNLewYYnKifhXGFXCiObD-7JIzFi6QlplGp98qWkGauKcyvRthra9bIEwHWa1w82g2lnrXnOFETLIhV94Vbhn9TkzGYM2LFmoRdYtGtSrfCOLVFRo0kjcj1FqKmsi1aXC3pz0YundZJx92A/s320/0009.png"/></a>
</div>
<p>The Cat doesn’t have a filesystem, nor even a concept of one.
Instead, all documents are subsumed into one big overarching workspace,
each workspace being identified by a unique key stored to its matching
disk (so that you can’t overwrite a disk with the wrong workspace, and
you won’t lose unsaved text with a new disk — that is, unless you force
it to do those things). Disk and memory permitting, you can create as
many documents as you like with the DOCUMENT/PAGE (typically Page Down)
key. They can be individually titled so you can scan the list to see
what’s present, and carry their own independent margin and document
settings. The Cat was never shipped with a memory capacity greater than
what its floppy drive could store, so one disk always equals one
workspace.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdRTq5RxhpnO1365Rmlca8hyphenhyphenVNvi1SECLa3pfwdMFnaosp68c5UeJEfUAqXKfDMLuTlx08z1XXHMkABb8tedx7MR2upzKCEGCA2p8a0Iz-k_jPo3vpIq2NCXSqtFxWwoN4jShPCueu-YaGDbwz1a6cBMhF_5G6IkyDB9IUd0cyXOiOKFbw3oR_wXgDAx0/s672/0010.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhdRTq5RxhpnO1365Rmlca8hyphenhyphenVNvi1SECLa3pfwdMFnaosp68c5UeJEfUAqXKfDMLuTlx08z1XXHMkABb8tedx7MR2upzKCEGCA2p8a0Iz-k_jPo3vpIq2NCXSqtFxWwoN4jShPCueu-YaGDbwz1a6cBMhF_5G6IkyDB9IUd0cyXOiOKFbw3oR_wXgDAx0/s320/0010.png"/></a>
</div>
How do you navigate without cursor keys or a mouse? The LEAP keys, when
held down, search either backwards (left) or forwards (right) in the
workspace based on what you type. You can LEAP by characters, or
paragraphs (LEAP to RETURN or RETURN-RETURN), or even documents
(LEAP-DOCUMENT). SHIFT-LEAP can be used to scroll the screen line by
line.
<p>
<p>LEAPing also is how you mark text. If you LEAP first to the beginning
of a block of text and then LEAP to the end of it, then press both LEAP
keys, that text is selected. Besides applying styles like boldface or
all-caps to it, you can move it by LEAPing elsewhere, or copy it and
move the copy, or delete it. A single level of undo is available with
the UNDO key.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiP8MWfCR9V7rPp06yVACYYiM_8dGlzZZ4FdeLn_3aTQHxdwvKSGkdCZPPmcoOKpE07KzFL3X6AuackWXfIfynVlIHi80u6oq8NGmBo4W0ieltpb47LY2oGpSgLecjJNhmqIvSf7nruRwon4pdeeO0Y_pcjazGJso2dlfy9buAxnNFUmuZh6rsEmb2ZHaE/s672/0011.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiP8MWfCR9V7rPp06yVACYYiM_8dGlzZZ4FdeLn_3aTQHxdwvKSGkdCZPPmcoOKpE07KzFL3X6AuackWXfIfynVlIHi80u6oq8NGmBo4W0ieltpb47LY2oGpSgLecjJNhmqIvSf7nruRwon4pdeeO0Y_pcjazGJso2dlfy9buAxnNFUmuZh6rsEmb2ZHaE/s320/0011.png"/></a>
</div>
Selecting text has other functions too. When I say everything goes in
the workspace, I do mean <em>everything</em>. The Cat is designed to be
collabourative: you can hook up your Cat to a phone line, or at least
you could when landlines were more ubiquitous, and someone could call in
and literally type into your document remotely. If you dialed up a
service, you would type into the document and mark and send text to the
remote system, and the remote system’s response would also become part
of your document. (That goes for the RS-232 port as well, by the way. In
fact, we’ll deliberately exploit this capability for the projects in
this article.)
<p>
<p>Raskin’s intention was that the document should handle dynamic text
as fluidly as static text (if Canon had let him and the firmware
permitted, this would undoubtedly have been how graphics were handled
also), and that such text should be computable on the fly. Let’s compute
my favourite easy-to-remember approximation of π. Type <tt>355/113</tt>
and highlight it with the LEAP keys: hold down LEAP LEFT and type 3
(jumps to the first three), then hold down LEAP RIGHT and type 3 again
(jumps to the last three), then press both LEAP keys.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjl5MVeo5Nlu2vO8HVOd4KHlbvKOYnk-s6rsY8sELMiLMNsXPju1G1FWBqq7ZcME5luYTfn7z7gOEUsnNbpspGsQh47CNU9hniZzs5adipOSBxLz9bt9s74-Bp3zuRPadhZc37mQ9H0xCPNO0eNFfskYxnWQhV7lKqYWiAZL1ZnNyUGbRgspRx8F0PZ_qE/s672/0012.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjl5MVeo5Nlu2vO8HVOd4KHlbvKOYnk-s6rsY8sELMiLMNsXPju1G1FWBqq7ZcME5luYTfn7z7gOEUsnNbpspGsQh47CNU9hniZzs5adipOSBxLz9bt9s74-Bp3zuRPadhZc37mQ9H0xCPNO0eNFfskYxnWQhV7lKqYWiAZL1ZnNyUGbRgspRx8F0PZ_qE/s320/0012.png"/></a>
</div>
<p>We can now tap USE FRONT-CALC (the G key), a little CALC icon will
briefly appear, and suddenly the result of the computation is displayed:
3.14. (The Cat defaults to two decimal digits of displayed precision but
this is configurable.) The dotted line underneath it indicates it is a
generated value.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhwKsnvUNjIy8EjTYMmUlsSMEIyZK3clzQNELoKs-78dy-IL8a6Nliccm_1Gl2gsCgXNvTMDU9SovS1mYPsrzuXIpIgPnSANPSMJKPshgzQ5GieaWVgpbgYcHXsD9KCmMOEHkSegu6RnxQiu6NWx3DLSjQIib61FgO7ej_Kqj-DhabGCx0yZCRLqeLY2gw/s672/0013.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhwKsnvUNjIy8EjTYMmUlsSMEIyZK3clzQNELoKs-78dy-IL8a6Nliccm_1Gl2gsCgXNvTMDU9SovS1mYPsrzuXIpIgPnSANPSMJKPshgzQ5GieaWVgpbgYcHXsD9KCmMOEHkSegu6RnxQiu6NWx3DLSjQIib61FgO7ej_Kqj-DhabGCx0yZCRLqeLY2gw/s320/0013.png"/></a>
</div>
<p>That’s handy as a desk calculator, and the syntax supports operator
precedence and parentheses as well as functions like <tt>sqrt</tt>, but
the really fun part is when we use this to store values in memory. Let’s
define a variable <tt>pi</tt> with the same calculation
<tt>355/113</tt>. We enter <tt>pi:355/113</tt> and then highlight it
with the LEAP keys (leap left to the <tt>p</tt>, leap right to the
<tt>3</tt>, then with LEAP RIGHT still held down press USE FRONT-LEAP
RIGHT to leap again to the second three, then with LEAP RIGHT still held
down tap LEAP LEFT and finally release both keys).</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7iROYlvbcvVkzp25KFOP9Uz9j9oUvzzGpsP7v3XLkXffRqzo2toZnTTJaF2X1mum8cYhih91pIq_w9womw7acGo5mhIFqovVfrXA-V8KMD7FqBQoqze0ta3OvJ2fCmaZcGP_q2KzwlT0uXOOVKlNBbGQDVrBxUHyZrw4Rx0JdgKR-np3UCqh-BDwbUkM/s672/0021.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj7iROYlvbcvVkzp25KFOP9Uz9j9oUvzzGpsP7v3XLkXffRqzo2toZnTTJaF2X1mum8cYhih91pIq_w9womw7acGo5mhIFqovVfrXA-V8KMD7FqBQoqze0ta3OvJ2fCmaZcGP_q2KzwlT0uXOOVKlNBbGQDVrBxUHyZrw4Rx0JdgKR-np3UCqh-BDwbUkM/s320/0021.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCPhyKVSoDdt7mz-A_Sr45RL3MRGVkFOxoZFf9YQAvkvupThoJS3fvDBEhDrHYyFVVl6fLOP632g3J-2CZnUh7l4ZY0Zz0ctgA8lCYpeP6TTQ0THD1MrgyXKvdi-GUZHMSjvipbW574K1cjUXaPKprOTFPch-ggxu5O9SoINibtrDqiUlzOwOTlUJqMfE/s672/0014.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiCPhyKVSoDdt7mz-A_Sr45RL3MRGVkFOxoZFf9YQAvkvupThoJS3fvDBEhDrHYyFVVl6fLOP632g3J-2CZnUh7l4ZY0Zz0ctgA8lCYpeP6TTQ0THD1MrgyXKvdi-GUZHMSjvipbW574K1cjUXaPKprOTFPch-ggxu5O9SoINibtrDqiUlzOwOTlUJqMfE/s320/0014.png"/></a>
</div>
<p>The same result appears, but we’ve now stored that as an internal
variable <tt>pi</tt>. We’ll do the same for <tt>radius</tt> and define
that to be <tt>6</tt>.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhctbAjKHGLLnTJD3iPxJr3ApkLBPFMtX0QjPbYgbkFtCwFYXBZn1v7Rfgs6VWkC_qtiEGzceNISd7GR1paCHrc0he_yclhaItcu1TV6cCg3Ym24-uLKH7CYpvV-oaq9yUnZbylpOX75GzCee3z_36WXvRGwfTMjPKTqJQEbhUahJZhExqnoO-02HjXmPo/s672/0015.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhctbAjKHGLLnTJD3iPxJr3ApkLBPFMtX0QjPbYgbkFtCwFYXBZn1v7Rfgs6VWkC_qtiEGzceNISd7GR1paCHrc0he_yclhaItcu1TV6cCg3Ym24-uLKH7CYpvV-oaq9yUnZbylpOX75GzCee3z_36WXvRGwfTMjPKTqJQEbhUahJZhExqnoO-02HjXmPo/s320/0015.png"/></a>
</div>
<p>With those variables computed, we can now use them in other
calculations. Anybody for π<i>r</i><sup>2</sup>? We enter
<tt>pi<em>radius</em>radius</tt> and calculate that.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhLfltYIbfHJ_yESHIAl69e92YB-Y8EL8Wi1ssAl_Nc4Y-ID_v9zilHlUfdpmFQYxz3_NqrivbjXcUw93emnFFO5Kgd1OxR_i8C7SY8UkSoLKXtz6GB-cZ-PybS1FrXufkz9eltciU53AcEsyW1pQMb3h2zCY7JB-P4q0ciG8Y-FVsNWuaesCMt601ZjwI/s672/0016.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhLfltYIbfHJ_yESHIAl69e92YB-Y8EL8Wi1ssAl_Nc4Y-ID_v9zilHlUfdpmFQYxz3_NqrivbjXcUw93emnFFO5Kgd1OxR_i8C7SY8UkSoLKXtz6GB-cZ-PybS1FrXufkz9eltciU53AcEsyW1pQMb3h2zCY7JB-P4q0ciG8Y-FVsNWuaesCMt601ZjwI/s320/0016.png"/></a>
</div>
<p>The correct answer to the given precision is shown.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjUDA7cTvV_3mgoJIalZpJ7jaV_SfFvY_HEFxcrnrf1f6_D9yK-jxl-V8Rn1PZ9byECGDNisatplGXPAuuGfx6vOsGkTTp8432VsAjsmr7KAsjGu6E5i4z-J-5mkaH56h67JDy0Wvd83oF98AXUt14kqZ5wTvwCYcGYpiBRlmwr04Xx_nnbEazbHhV0HZ4/s672/0017.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjUDA7cTvV_3mgoJIalZpJ7jaV_SfFvY_HEFxcrnrf1f6_D9yK-jxl-V8Rn1PZ9byECGDNisatplGXPAuuGfx6vOsGkTTp8432VsAjsmr7KAsjGu6E5i4z-J-5mkaH56h67JDy0Wvd83oF98AXUt14kqZ5wTvwCYcGYpiBRlmwr04Xx_nnbEazbHhV0HZ4/s320/0017.png"/></a>
</div>
<p>As you may have already guessed, those values we entered aren’t
fixed: they can be changed and recalculated. Let’s change
<tt>radius</tt> to 10 by tapping LEAP LEFT until we’re back in that
field (or LEAP LEFT to the 6). If we press USE FRONT-CALC while within
the result of a calculation, the expression you entered to generate it
is preserved and now can be edited.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgySAXj2oTsmvgi9MsEg3zISKUyMWPDwYdNhK1qpaLeOUcOWAKHg1zfY-Cd68nEere-M9pC9keYmm1KD__Qf-fG2-PkZ8PPdrO770k1Li0ysdqTXLmpCiLxc8gHYW62t3wK5TYGuHLTMdH59WpXp-zmppiNxYoA9bmcbdy-pZIn655K1fnQ5aIYu3VjwG4/s672/0018.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgySAXj2oTsmvgi9MsEg3zISKUyMWPDwYdNhK1qpaLeOUcOWAKHg1zfY-Cd68nEere-M9pC9keYmm1KD__Qf-fG2-PkZ8PPdrO770k1Li0ysdqTXLmpCiLxc8gHYW62t3wK5TYGuHLTMdH59WpXp-zmppiNxYoA9bmcbdy-pZIn655K1fnQ5aIYu3VjwG4/s320/0018.png"/></a>
</div>
<p>We change the 6 to a 10 and press USE FRONT-CALC to recalculate its
result, which in turn will update the variable and recompute anything
depending on that variable.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzLQSUyXRHc2af_T-OMb4VyFAh8k7zYtVPII0IKKccSrcX8Gxca2WrVENxsWIDD82vDcoWAnFtbb3DEau2rvLN493gMryXuLXuc34knmu7nxrf9FLZhWilwF0_qV38opRSLJjBDNo7yoOuyOoqxxNhUVJJFBmBvT5Q8iAQcJ0b4q_n5LT_fouZu2G8k7I/s672/0020.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhzLQSUyXRHc2af_T-OMb4VyFAh8k7zYtVPII0IKKccSrcX8Gxca2WrVENxsWIDD82vDcoWAnFtbb3DEau2rvLN493gMryXuLXuc34knmu7nxrf9FLZhWilwF0_qV38opRSLJjBDNo7yoOuyOoqxxNhUVJJFBmBvT5Q8iAQcJ0b4q_n5LT_fouZu2G8k7I/s320/0020.png"/></a>
</div>
And thus our <tt>pi<em>radius</em>radius</tt> duly changes as well. If
we changed the name of the variable or entered other nonsense or did
something like divide by zero, the Cat will calmly display question
marks to indicate any dependent result is invalid, and you can edit the
expression with CALC again to fix it.
<p>
<p>This process can be slow if there are lots of things to compute, and
the 5MHz 68K isn’t exactly a speed demon. Pressing any key while the
CALC icon is displayed will cancel the operation, true for any such task
including printing except DISK (for obvious reasons) and one more to be
discussed.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_7isOdNNDgIHW5scARU17EBK9WoNH3Lza-torRnXv5ocv8tddHMlDoOK_u5SB88qrYeROtQlTNP0F_9K8tueWpSCpqcJvEb18ozzxa0w_qKk8VaxTE7XIUqmT0T1Lu8E7zE6v0EiWpUKaFN0m7_iI51oDWHPyIJQkHzms3iCjFwznormJcLmylhyphenhyphene0Og/s672/0000.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh_7isOdNNDgIHW5scARU17EBK9WoNH3Lza-torRnXv5ocv8tddHMlDoOK_u5SB88qrYeROtQlTNP0F_9K8tueWpSCpqcJvEb18ozzxa0w_qKk8VaxTE7XIUqmT0T1Lu8E7zE6v0EiWpUKaFN0m7_iI51oDWHPyIJQkHzms3iCjFwznormJcLmylhyphenhyphene0Og/s320/0000.png"/></a>
</div>
Does this sound a little like a spreadsheet? I’m so glad you asked!
Because Cat text is fixed-width, setting up consistent rows and columns
is simply a matter of tab stops and character width, adjusting the
document margins if necessary. Tabs separate cells and the editor treats
them as such with the function <tt>use()</tt>.
<p>
<p>Let’s enter a simple spreadsheet where we will compute the tax on a
sale of widgets and then total the transaction. We’ll specify unit price
and number sold, and compute a fixed tax of 10% (though this could just
as easily be a variable). There are two tab stops between the Unit Price
and the Sales, so the expression becomes
<tt>use(-3)<em>use(-1)</em>0.10</tt> to compute unit price times sales
times 10%.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgakah5BXSCStgk-jMRAwLu0qizwCrRoxdsqMgQ92rvIA4g592fkirOEFbFalV2eN9AU5TjFBt6GFILj7jCOoMf9Zmlx4qOWzDoHnNHEL3UGitTPl6aZZ-_xnpKRQL9k-ttrWF41sPKhqjbvET7D9ghrs6oa63gPA5v-PIo6NHmDYQDORSlRkB7ZGd_A_8/s672/0001.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgakah5BXSCStgk-jMRAwLu0qizwCrRoxdsqMgQ92rvIA4g592fkirOEFbFalV2eN9AU5TjFBt6GFILj7jCOoMf9Zmlx4qOWzDoHnNHEL3UGitTPl6aZZ-_xnpKRQL9k-ttrWF41sPKhqjbvET7D9ghrs6oa63gPA5v-PIo6NHmDYQDORSlRkB7ZGd_A_8/s320/0001.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiBueXvPNRogaN-zplGukQOrl6JhoI_jZtQnOI5lMIQyqBf7LmhSbXvOhdIfjoEecd8q-eexHODcSGmavk128ya_ixtEG49JMeIRHCcsuAkpdpiMe11ARy0vF6DxSfUmwco4pW-3_LdihbvoWE5Z12WBlS7M9j-RzYUu1T_nRo5SYI8FCeilMS4QneILE8/s672/0002.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiBueXvPNRogaN-zplGukQOrl6JhoI_jZtQnOI5lMIQyqBf7LmhSbXvOhdIfjoEecd8q-eexHODcSGmavk128ya_ixtEG49JMeIRHCcsuAkpdpiMe11ARy0vF6DxSfUmwco4pW-3_LdihbvoWE5Z12WBlS7M9j-RzYUu1T_nRo5SYI8FCeilMS4QneILE8/s320/0002.png"/></a>
</div>
<p>That yields the tax.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjq1A6er3NiLMt_YbvrTo51YMeWl1qiVmZlkQO2jH5KTw3EA4eX4Ajvvi_VSZykjUWCRki_ABaDXZMM7mCqBi3wKHnE18CsqlsNYZ9q9XNtJNpHtsWq04mZtVt6PnbDUq19tgo19UAh7Av1A2QWl3PnmqrHpZD1xcCuUz7_dGkMec4iOcvix8WnLar7FfY/s672/0003.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjq1A6er3NiLMt_YbvrTo51YMeWl1qiVmZlkQO2jH5KTw3EA4eX4Ajvvi_VSZykjUWCRki_ABaDXZMM7mCqBi3wKHnE18CsqlsNYZ9q9XNtJNpHtsWq04mZtVt6PnbDUq19tgo19UAh7Av1A2QWl3PnmqrHpZD1xcCuUz7_dGkMec4iOcvix8WnLar7FfY/s320/0003.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgjJqIwAZ1hy9Vq20_70JSCmpEPTW-2nW0m_x3Nztw4P80Dsv6xVXZffbAd4fDpk2evyds4YVwAYVXB4UXXflVWV-twsMmPvDnLSU2zT2cb3ZJACMGf5KmqBZUHpMM_jxcOmWGiNIQeOMZQQe-Fyai1-D9nuB-f3wLbKtEof4YlmFqb4xVUalBfzhOtMbw/s672/0004.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgjJqIwAZ1hy9Vq20_70JSCmpEPTW-2nW0m_x3Nztw4P80Dsv6xVXZffbAd4fDpk2evyds4YVwAYVXB4UXXflVWV-twsMmPvDnLSU2zT2cb3ZJACMGf5KmqBZUHpMM_jxcOmWGiNIQeOMZQQe-Fyai1-D9nuB-f3wLbKtEof4YlmFqb4xVUalBfzhOtMbw/s320/0004.png"/></a>
</div>
<p>To get the total, we will now reference <em>that</em> cell and add it
to the sales price with <tt>use(-1)+(use(-2)*use(-4))</tt> (notice that
everything is relative; positive values are also valid).</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbJEku3PH40XqMEj-2t1E6qIutJ1Yg46NCVmy9fnGVY9cNC8VrIYgz8TfWZ6y1wUHd0e6ARcis316yUN2OkOV0Cze386n0YDcQt5x7ULuPxIknUJwL6ROq6JRiSyvcC6pWudLezLdeHRjiW4WOSTaTfyO8p5tJipNVVro6VqaIZyyfz2IpltJMKWNeTA8/s672/0006.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjbJEku3PH40XqMEj-2t1E6qIutJ1Yg46NCVmy9fnGVY9cNC8VrIYgz8TfWZ6y1wUHd0e6ARcis316yUN2OkOV0Cze386n0YDcQt5x7ULuPxIknUJwL6ROq6JRiSyvcC6pWudLezLdeHRjiW4WOSTaTfyO8p5tJipNVVro6VqaIZyyfz2IpltJMKWNeTA8/s320/0006.png"/></a>
</div>
<p>Even though the unit price and sales count are simply plain text we
entered and didn’t originate as computed values, we can still change
them and press CALC to recalculate the miniature spreadsheet. If we
wanted to address a different <em>row</em>, we add a second argument to
<tt>use()</tt> for the Y delta (such as <tt>use(-1 1)</tt> for the value
in the next row but the previous column; the arguments to the function
are separated by spaces). All of your variables and expressions are
saved to disk as part of the document.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhH53KxtaEiyHB_rG6YyGMf_HUm28GF0_rogVxO6oo0i-VE50vCRUtwuIgpT4ZUwvc__67HwD7rOQJoybyjva5ZWI82uCWRRyKdYorKjBZX28EdQTg56PKpYbeNqGEAikUoCcLXr6HxsK577ox1d0fog_tpyaRZE4O-b4o5b3YtIlY6jmVrRJu7F8_X5u0/s672/0022.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhH53KxtaEiyHB_rG6YyGMf_HUm28GF0_rogVxO6oo0i-VE50vCRUtwuIgpT4ZUwvc__67HwD7rOQJoybyjva5ZWI82uCWRRyKdYorKjBZX28EdQTg56PKpYbeNqGEAikUoCcLXr6HxsK577ox1d0fog_tpyaRZE4O-b4o5b3YtIlY6jmVrRJu7F8_X5u0/s320/0022.png"/></a>
</div>
<p>Of course, you can do other sorts of lists with it … or sort other
sorts of lists with it. Here is a list of random, commonplace, everyday
words you regularly use in conversation. We’ll highlight them and then
press USE FRONT-SORT (usually the comma key).</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWOWoEzdcH1G1d-toclzFJT8XjwNoXelY9PGVDt7FrQm_cK5uTAzYUeBP-YOldTbRjLzSpGdOCh6dygW5C326gz2hlpH7_J7S0aR-cNdhHkgup_Zz9d_wEoeo07q-a2ZXYBNcjIVSbjh_ZIHuXVyNkTV8wOzFU4HtZH698v27Xo3fkTygjl5XqdjBccto/s672/0023.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhWOWoEzdcH1G1d-toclzFJT8XjwNoXelY9PGVDt7FrQm_cK5uTAzYUeBP-YOldTbRjLzSpGdOCh6dygW5C326gz2hlpH7_J7S0aR-cNdhHkgup_Zz9d_wEoeo07q-a2ZXYBNcjIVSbjh_ZIHuXVyNkTV8wOzFU4HtZH698v27Xo3fkTygjl5XqdjBccto/s320/0023.png"/></a>
</div>
<p>And presto, a dictionary-sorted list. Lists have other applications,
naturally, like mail merges. The LEARN facility provides keystroke
macros, so with a list and some unique field sequences you could
implement such a scheme in a kludgey but effective fashion.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiUpFzR1uq-F8ab8O40aVTEZMo7tTC7jngcTZRkSbVECulAbj0kvXrtZG9MgarhktI0oEOCv7W0bXispwujCPaP6-JbWY4kylKPVu3oGfXzrlK18wIkGb_wAhz9jespT700aRrZzITseb0jV9vHHRQkfYf7QwM4KS8dQ2cLt8PmjBlvks7zxW-dXM-Tq58/s672/0005.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiUpFzR1uq-F8ab8O40aVTEZMo7tTC7jngcTZRkSbVECulAbj0kvXrtZG9MgarhktI0oEOCv7W0bXispwujCPaP6-JbWY4kylKPVu3oGfXzrlK18wIkGb_wAhz9jespT700aRrZzITseb0jV9vHHRQkfYf7QwM4KS8dQ2cLt8PmjBlvks7zxW-dXM-Tq58/s320/0005.png"/></a>
</div>
It would be a gross distortion to say every nuance of the Cat is
discoverable and/or self-explanatory. In fact, some procedural aspects
of it, while sensible once you learn them, are not at all obvious.
<p>
<p>But there is ample online help if you hold down USE FRONT/Control and
press HELP (by default the N key). This is the default screen if there
is no pending error state. If there were an error, such as a problem
reading the disk, the Cat will beep politely and pressing USE FRONT-HELP
will instead explain the error in prose. (Raskin hated modals.)</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjkZKSOYNUOzKxy7a2KBS2a9Ue9Gsfrb-SrX0PFrreMknjVNHaZ76PEKaLHNi_IRvt8XAqBBa8qXcEflnvE6h7fecezP8f7OT0Ej-e7uJP2eL74kUAzD6j9nJ9sGBWc9aOq4H5nruVwRLHy3caZPZWv6FnfKjX3y1YNMhojNgU-dgiY9hUo9WN9Ru3ySrM/s672/0010.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjkZKSOYNUOzKxy7a2KBS2a9Ue9Gsfrb-SrX0PFrreMknjVNHaZ76PEKaLHNi_IRvt8XAqBBa8qXcEflnvE6h7fecezP8f7OT0Ej-e7uJP2eL74kUAzD6j9nJ9sGBWc9aOq4H5nruVwRLHy3caZPZWv6FnfKjX3y1YNMhojNgU-dgiY9hUo9WN9Ru3ySrM/s320/0010.png"/></a>
</div>
Either way, once in the help facility, you can release the HELP key and,
<em>while USE FRONT/Control is still down</em>, press a key you want
information about. Like, here’s help on … HELP.
<p>
<p>Here are the other keys we looked at before, SETUP, CALC and SORT.
Every bit of their text is also built-in to ROM.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjSSN2tVXE5s_jQzjehfnXj3NjM1i1NjwVVggvMw7__yz_2Co8i8FC9CPn7i0SsAyMJLXT1XXp5ZNMgE9xcjHku1eKmhaMAvwhSEi7mDkHLEFBgiZ-1Wiy7VFdyc7ELptLmFkjuDnDld9SEKEImgLZiZoZ8q4G0dHulw8OZSsF1tUSO57txF1N4gEJqrSM/s672/0007.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjSSN2tVXE5s_jQzjehfnXj3NjM1i1NjwVVggvMw7__yz_2Co8i8FC9CPn7i0SsAyMJLXT1XXp5ZNMgE9xcjHku1eKmhaMAvwhSEi7mDkHLEFBgiZ-1Wiy7VFdyc7ELptLmFkjuDnDld9SEKEImgLZiZoZ8q4G0dHulw8OZSsF1tUSO57txF1N4gEJqrSM/s320/0007.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJquQ370T0-TNo_DtL-zXtFvuUKTjvFGJNFgMifZFU2HtECZhUTh3b_QQ1bNK75YNK0l5g4zcA0FdPUARGH5caCBVYRAPq-tqDEWR8646F9Y-y-cUQRcoVKlsOcyYU1YTTfiQZKV5UJNUif0ccUPFCSq1mj4A9U3NOZ2_-RSs-O8be1bOY_R8GULGz7R8/s672/0008.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJquQ370T0-TNo_DtL-zXtFvuUKTjvFGJNFgMifZFU2HtECZhUTh3b_QQ1bNK75YNK0l5g4zcA0FdPUARGH5caCBVYRAPq-tqDEWR8646F9Y-y-cUQRcoVKlsOcyYU1YTTfiQZKV5UJNUif0ccUPFCSq1mj4A9U3NOZ2_-RSs-O8be1bOY_R8GULGz7R8/s320/0008.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjx7KLfyjtyjRfg1Rvcb8v8_fqMcEcgtxC9D00spZ7VLi4rnt62b42mv6y9wfmpIdcRTQDDfqSAmzIO4CV2GIdRlNQMr-VTHbgpuxDIIBjzRYZ3G1RhiP4soIi9tBXOyrbXbGTUYXDlQPaG6Fg99rBc50yL5WLIn53HOYSLW1-qX8_9Yb9qdwWd2QrKVuU/s672/0009.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjx7KLfyjtyjRfg1Rvcb8v8_fqMcEcgtxC9D00spZ7VLi4rnt62b42mv6y9wfmpIdcRTQDDfqSAmzIO4CV2GIdRlNQMr-VTHbgpuxDIIBjzRYZ3G1RhiP4soIi9tBXOyrbXbGTUYXDlQPaG6Fg99rBc50yL5WLIn53HOYSLW1-qX8_9Yb9qdwWd2QrKVuU/s320/0009.png"/></a>
</div>
<p>You can also get a hidden credits screen from here.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgYO4EU0R2F3iDejp9_KM6Y-kFBIEMzYs-gbn1B74V6EmGI1zgud0VluqpwvB3Ivq0bvNSyQFcbz8LO-RXgseCcpqMOKOqyjAkXkp4M2T5MVtfk8H8GEEfft42pctxYgoJ7yEYki1x5Fta59vmibk-aGI6QI9YpsfBfFYmVvX_X2yQLfBJpZdLLlXQBfuw/s672/creds.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgYO4EU0R2F3iDejp9_KM6Y-kFBIEMzYs-gbn1B74V6EmGI1zgud0VluqpwvB3Ivq0bvNSyQFcbz8LO-RXgseCcpqMOKOqyjAkXkp4M2T5MVtfk8H8GEEfft42pctxYgoJ7yEYki1x5Fta59vmibk-aGI6QI9YpsfBfFYmVvX_X2yQLfBJpZdLLlXQBfuw/s320/creds.png"/></a>
</div>
In the document, hold down LEAP LEFT, then hold down SHIFT, then type Q
W E R A S D F Z X C V (nothing will appear), then release SHIFT, release
LEAP, and finally press USE FRONT-EXPLAIN. Good to see a <em>real</em>
doctor doctor on the team.
<p>
<h3>
Sallying tForth into the ROM
</h3>
<p>
<p>Anyway, except for that easter egg, everything you saw was what Canon
wanted you to see — a sophisticated word processor. But what Jef Raskin
wanted you to see, and Canon didn’t, was a general-purpose computer that
just happened to use a word processor-like primary interface, complete
with a built-in programming language. That language is Forth, as
descended from <a href="/2024/05/refurb-weekend-canon-cat.html">the
original Swyft</a>, or more accurately tForth, an implementation using
tokens (the “t”) instead of direct addresses for each <i>word</i> in a
word definition. This requires a level of indirection to look up the
execution address when a word is executed, a semantic difference between
this concept and a bytecode approach, but it also means that words can
be redefined or even deleted without leaving stale pointers in unrelated
words that reference them. More importantly, code can be considerably
more compact because tokens don’t necessarily need to be the size of an
entire address (Cat tokens are byte-sized, though often taken as
word-sized groups) and the code they reference can be moved and
compacted. This was important given the 256K of memory the Cat shipped
with, which wasn’t a huge amount even in the mid-1980s and had to be
shared with the video circuitry.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhbz-mgvDG1fMJ27wz4ip7vJnTVF7RdbM-LMhoI-ALKvwL_alToFEbteGriKAY5ViQiGIL0AMwciN92klP3Q5mMd9SL5CbyU-HbRJhOHvgMmDL0gtg_P5AUH0UlpQXr4y3MjAl63NK7hZFpnNKqZpDSZd7JrGiBsyS0OoIz9JQtsB0Z8xraJqbtiCRuxyI/s672/0003.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhbz-mgvDG1fMJ27wz4ip7vJnTVF7RdbM-LMhoI-ALKvwL_alToFEbteGriKAY5ViQiGIL0AMwciN92klP3Q5mMd9SL5CbyU-HbRJhOHvgMmDL0gtg_P5AUH0UlpQXr4y3MjAl63NK7hZFpnNKqZpDSZd7JrGiBsyS0OoIz9JQtsB0Z8xraJqbtiCRuxyI/s320/0003.png"/></a>
</div>
<p>Nevertheless, although officially undocumented, a gateway to Forth
remains in the Cat. It is triggered by a straightforward — albeit
unlikely — series of keystrokes, which works in both MAME and the real
hardware. Start out by typing <tt>Enable Forth Language</tt> (easiest in
a blank document or workspace).</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1eGeNROWNnf_E7ivjxwjnK-5I6V1Evfj6mNTbUDf-XrJ0eqhCcILz8H5-qXW4nHo7ujeaZ3oHNH2kCa1TOfD8P6FYVLdasbnWuQ9ovWzQhSaTJFoAz4TLrbCshxzKpb-WKTIEpxoSwhHd10spfOm0tXwXSVfGN8GCw3uMDETiT-LsntHKql_yzaIvxhA/s672/0004.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj1eGeNROWNnf_E7ivjxwjnK-5I6V1Evfj6mNTbUDf-XrJ0eqhCcILz8H5-qXW4nHo7ujeaZ3oHNH2kCa1TOfD8P6FYVLdasbnWuQ9ovWzQhSaTJFoAz4TLrbCshxzKpb-WKTIEpxoSwhHd10spfOm0tXwXSVfGN8GCw3uMDETiT-LsntHKql_yzaIvxhA/s320/0004.png"/></a>
</div>
<p>Highlight it by pressing both LEAP keys.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhyTx58NKAbciiJmYCACD_eO66bKA-vGjEBeztnUkP91v4adlcsTzimNNEH7WhNi4AYAxmJv8Z14luMFYHN4fsiUQ2bcAyYTxeHDJxCYA8YuL8wsKa5KJnJhIIrBHLWFRT8knsz6-HxHmA3qOV2pdocIISLDfM_Sp3sFiCijjh4JugYYUnyeEys_HGyOdo/s672/0005.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhyTx58NKAbciiJmYCACD_eO66bKA-vGjEBeztnUkP91v4adlcsTzimNNEH7WhNi4AYAxmJv8Z14luMFYHN4fsiUQ2bcAyYTxeHDJxCYA8YuL8wsKa5KJnJhIIrBHLWFRT8knsz6-HxHmA3qOV2pdocIISLDfM_Sp3sFiCijjh4JugYYUnyeEys_HGyOdo/s320/0005.png"/></a>
</div>
<p>Now press USE FRONT-ANSWER (usually your backspace or [Mac] delete
key). The bottom of the screen will flash and/or a real Cat will beep,
and a little “FORTH” icon will briefly light and then disappear.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh-3E-fnCzDc29yuW6cklkmNUQ343jDkoK7AdKgOe0wZlAZC0kpG7LLMosngQah7UWxwBIP_g7SEutvB3bPH0slYkpZT81ZVrxMCwfq2JEhJvzsOHrcKItynV4VIEQ6l4OzqDszJm_a6CMEBndq9DhnvbdEDFZJw6fB-boZsSmpeHNaxbFbQH-br1fG3hs/s672/0006.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh-3E-fnCzDc29yuW6cklkmNUQ343jDkoK7AdKgOe0wZlAZC0kpG7LLMosngQah7UWxwBIP_g7SEutvB3bPH0slYkpZT81ZVrxMCwfq2JEhJvzsOHrcKItynV4VIEQ6l4OzqDszJm_a6CMEBndq9DhnvbdEDFZJw6fB-boZsSmpeHNaxbFbQH-br1fG3hs/s320/0006.png"/></a>
</div>
<p>When the FORTH icon has disappeared, press SHIFT-USE FRONT-SPACE.
Nothing will appear to happen until you hit RETURN/ENTER a few times …
and get a Forth <tt>ok</tt> prompt.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjayz3MBcGctBtz4LqUtxzNSzy_gEp96AVnuD7DrI9ORjpawyMWYCUbEZl7HCl_tksx_bHqL2LVSfaa9JmjarmYZg2vuP2BxSUmpySuSxPDQ4xXLSWKwz3UMJY0qB-7KWpe4VEp7TNd6ZfWaQYYyII15h-NqssejJwcbpOyBMPMhfIa6mz7tFhNDxXPDsA/s672/0007.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjayz3MBcGctBtz4LqUtxzNSzy_gEp96AVnuD7DrI9ORjpawyMWYCUbEZl7HCl_tksx_bHqL2LVSfaa9JmjarmYZg2vuP2BxSUmpySuSxPDQ4xXLSWKwz3UMJY0qB-7KWpe4VEp7TNd6ZfWaQYYyII15h-NqssejJwcbpOyBMPMhfIa6mz7tFhNDxXPDsA/s320/0007.png"/></a>
</div>
Lock this change in by typing the magic incantation <tt>-1 wheel!
savesetup re</tt> and press ENTER. This enables “expert mode” and saves
it to battery-backed settings RAM, then returns to the editor. Now the
Forth mode is unlocked, and the hacking can begin. In future you won’t
need to do the “Enable Forth Language” dance again as long as your
settings RAM or battery doesn’t get whacked.
<p>
<p>Forth is accessed in two ways, one of which you just saw for entering
commands at a traditional REPL-like prompt. This is the mode we will
primarily be using, and is fully supported by the operating system, but
the other fashion is clearly more Raskinesque. Remember how you could
highlight expressions and have the Cat compute them?</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAP4VzSZ9Q8hlo-Vdpy4jEMiTQ2y507kEdX10qq2l4qwqxtj0LVwvvJgDFsLHRi1tssjP-PFjs1zrr7uYw_E13V5pyOgz1ENrnGEZ7GyHoXQvEDtVDls1qEgyB78AslKpG-GWOcK2rvc75eJHB-T1E-b3WHk6NvWDerPP1RVvWCyoX7pnhlmmvjXalf2o/s672/0001.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjAP4VzSZ9Q8hlo-Vdpy4jEMiTQ2y507kEdX10qq2l4qwqxtj0LVwvvJgDFsLHRi1tssjP-PFjs1zrr7uYw_E13V5pyOgz1ENrnGEZ7GyHoXQvEDtVDls1qEgyB78AslKpG-GWOcK2rvc75eJHB-T1E-b3WHk6NvWDerPP1RVvWCyoX7pnhlmmvjXalf2o/s320/0001.png"/></a>
</div>
Well, <em>now</em> that works for Forth, but instead of USE FRONT-CALC,
you’ll use USE FRONT-ANSWER. This article will not seek to teach you
Forth (the
<a href="https://www.forth.com/starting-forth/0-starting-forth/">online
version of <i>Starting Forth</i></a> is a far better instructional tool
than I could ever write), and I certainly do not profess to have
superior fluency in it myself. However, for illustrative purposes I’ll
be using relatively simple code that most people should be able to grok
at a conceptual level. Just remember that since Forth is the canonical
stack language, everything gets pushed and popped to stacks, and as such
control structures and arithmetic appear “backwards” compared to other
programming languages. (Forth’s famous use of reverse Polish notation is
thus simply a logical consequence of the language.)
<p>
<p>In any event, upon pressing USE FRONT-ANSWER …</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgA_MX83KFkDHp9iuFl8jaPEZ3joQhkUIwbJG0WYNqEEojF9_OFRJ_uDIlFO_DHMHXovCI32PVzO0dqaZNUjONo8Pp_LN8YiW1LpUTHHFKnYDjlevYbhdJVk0lq-SOpw8Dw0-knTA5n1FkD-aWXi373Q735Ju5mM4SJk2ZQkXeWcK2syFXpWVZ4acw7Yo0/s672/0000.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgA_MX83KFkDHp9iuFl8jaPEZ3joQhkUIwbJG0WYNqEEojF9_OFRJ_uDIlFO_DHMHXovCI32PVzO0dqaZNUjONo8Pp_LN8YiW1LpUTHHFKnYDjlevYbhdJVk0lq-SOpw8Dw0-knTA5n1FkD-aWXi373Q735Ju5mM4SJk2ZQkXeWcK2syFXpWVZ4acw7Yo0/s320/0000.png"/></a>
</div>
<p>… the answer is computed (<tt>1 2 3 + +</tt>, i.e., 3 plus 2, and
that result plus 1) and printed (<tt>.</tt>), the editor captures the
output, and then inserts the result: six.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4hB0k-828RPfz4-7lUzQaSMnWpl7AjQAwk6dehK1rJc1egMtfRoZA5UPhSvdk_nBP49OnFeN0SGFpMC6iXzh6ixe3MVs5CgeLwTvjLkfn1bqWCAs3qpxjMvlU0aOLlBQvnqWXY4qYc5dQRcdjiSZSx2Oiwv0GInCiK2ZBWAMhtaGnK1FXPVN7eQroPn0/s672/0002.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg4hB0k-828RPfz4-7lUzQaSMnWpl7AjQAwk6dehK1rJc1egMtfRoZA5UPhSvdk_nBP49OnFeN0SGFpMC6iXzh6ixe3MVs5CgeLwTvjLkfn1bqWCAs3qpxjMvlU0aOLlBQvnqWXY4qYc5dQRcdjiSZSx2Oiwv0GInCiK2ZBWAMhtaGnK1FXPVN7eQroPn0/s320/0002.png"/></a>
</div>
Interestingly, if you try to ask the online help for information on the
ANSWER key, you just get the ERASE key help page no matter what you do.
ANSWER isn’t even referenced in the user manual. While ANSWER does
appear on the front of the key just like any other key you can USE FRONT
with, it does nothing until you enable Forth, and many or even most of
its contemporary users likely never pondered what it was there for.
<p>
<p>Aside: what if you make an error?</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3ghPSOkqMWy6PAvxlBFVGFDfH6tQJ6gXfvQ4FpkCb4e_j8yQbHwLqhuXcVGkzIN7SzMV1AhmMFPB45kLD5ZCAjByDgqaCzhiYo8zVDx2UDRscEWt-diuFiL95aFZJGN3Wk0vGWCQby6kxZIAoilc-0HZbI_a3aGqw9T5bFUj71VioBlmZo4N5rZorLjs/s672/0009.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3ghPSOkqMWy6PAvxlBFVGFDfH6tQJ6gXfvQ4FpkCb4e_j8yQbHwLqhuXcVGkzIN7SzMV1AhmMFPB45kLD5ZCAjByDgqaCzhiYo8zVDx2UDRscEWt-diuFiL95aFZJGN3Wk0vGWCQby6kxZIAoilc-0HZbI_a3aGqw9T5bFUj71VioBlmZo4N5rZorLjs/s320/0009.png"/></a>
</div>
<p>Say we entered <tt>bogus .</tt> instead, a Forth word you can take on
faith is not built-in to the Cat, and USE FRONT-ANSWER with that. The
FORTH icon lights up and flashes, and there is no output. Here, USE
FRONT-HELP will tell you what it didn’t like:</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiHtRXqEpawaMLLoS0zsFC4QTYCfz4H4wTJg_U9WkllQXT1m27hyphenhyphen4kKYsy54Us0pfDy2Kf10FCPxadebTuhKDPDOVTlYArIOPbbwP6keB3wJVBHoXu7oR9j8LJUW4ZhnJLL-NE2N1Q6TPb9zBKc8Ub_jBXbfGDo7ED_853INy-AJqAcFWH2Ct515xg4ezI/s672/0008.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiHtRXqEpawaMLLoS0zsFC4QTYCfz4H4wTJg_U9WkllQXT1m27hyphenhyphen4kKYsy54Us0pfDy2Kf10FCPxadebTuhKDPDOVTlYArIOPbbwP6keB3wJVBHoXu7oR9j8LJUW4ZhnJLL-NE2N1Q6TPb9zBKc8Ub_jBXbfGDo7ED_853INy-AJqAcFWH2Ct515xg4ezI/s320/0008.png"/></a>
</div>
This is tForth for “I don’t know that word.” Forth has a reputation as a
language so close to the metal that one wrong move will bring the system
down. I’ve personally experienced that writing for the 68K Mac in Pocket
Forth, where unbalancing the stack can lead to a system error faster
than you can say guru meditation. Yes, Forth programmers are Real Men,
Manly Men, Speakers of the One True Manly Language, Men on the Bleeding
Edge, who point and laugh uproariously at you toddling along with your
IDE and your wussy little C compiler. (Or womenly women, or neither.
This blog is totes egalitarian.)
<p>
<p>So here’s a little warning: tForth is not nearly that hostile, but
while it may have more guardrails than the typical Forth implementation,
that’s not saying very much. Although the ROM is relatively resistant to
rookie mistakes and I’m not aware of anything that can permanently brick
the logic board, you <em>can</em> damage things (like getting the track
and address transposed when you command the disk drive to seek!), you
<em>can’t</em> interrupt a Forth operation if you inadvertently cause an
infinite loop, you <em>can</em> freely trash the system and anything in
memory, and you <em>can</em> lock up the system so severely that nothing
will fix it but a powercycle. To borrow
<a href="http://www.codersnotes.com/notes/a-constructive-look-at-templeos/">a
quote from Terry A. Davis</a>, tForth “is a motorbike. If you lean over
too far, you’ll fall off. Don’t do that.” This particular minefield
won’t blow off your arms, but it might throw you on the ground pretty
hard.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjD0q69KAfsD-qeVXfBAYhY-v2XIQp42bB1VZLiZ3DbGqMt2ZNNJww0J30hq14ApuIo7u96Zddt-5_oaE5EKphdKWbkcK6b5y4VwgkHODbhMoXQ95BmG8mYov3AnXAFlcaCfXdB2mZe5ZlkbU4APm99oDFBZIAA4ZB_ZG1pLCqZAx5pyf-J-34rSmKCKNo/s672/0003.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjD0q69KAfsD-qeVXfBAYhY-v2XIQp42bB1VZLiZ3DbGqMt2ZNNJww0J30hq14ApuIo7u96Zddt-5_oaE5EKphdKWbkcK6b5y4VwgkHODbhMoXQ95BmG8mYov3AnXAFlcaCfXdB2mZe5ZlkbU4APm99oDFBZIAA4ZB_ZG1pLCqZAx5pyf-J-34rSmKCKNo/s320/0003.png"/></a>
</div>
Anyway, we’ll return to our previous example and do some more messing
around in MAME before we switch over to the real system. Press SHIFT-USE
FRONT-SPACE and type the Forth word <tt>page</tt> to both clear the
screen and home the cursor (<tt>cls home</tt> also works).
<p>
I should note parenthetically that on a real Cat you can soft-reset the
system by typing <tt>cold</tt> at the <tt>ok</tt> prompt. It’s very
handy for reducing wear on the power switch, but doesn’t seem to work in
MAME.
<p>
<p>A fair bit of the fundamentals on which this article is based come
from the copious technical documentation on the platform, collected and
preserved at <a href="http://www.canoncat.net/">canoncat.net</a>. Some
of it actually hails from the Swyft’s development, but the Cat is so
similar to its ancestor that most of their content is still relevant.
We’ll then build on this basis for the tricks we’ll pull.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgNkYQwJnTRshy92r-J7c8ljxhoa0pYLTAz7JeOyiR8RP_8sxm_xmeB1JLp2CfygyiGGgSjRQRmgndgklAgMyfbjJQbuDiC2BtGwa0MRbaJfI5U4q1G-HaXB2P4OMOGXbR_0musnDZLbkZFF7Nb7pAJerf9J0NpGOcePI23yCVMBybCTiMj_aRpx5VNhp4/s3300/onepage.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" height="320" data-original-height="3300" data-original-width="2550" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgNkYQwJnTRshy92r-J7c8ljxhoa0pYLTAz7JeOyiR8RP_8sxm_xmeB1JLp2CfygyiGGgSjRQRmgndgklAgMyfbjJQbuDiC2BtGwa0MRbaJfI5U4q1G-HaXB2P4OMOGXbR_0musnDZLbkZFF7Nb7pAJerf9J0NpGOcePI23yCVMBybCTiMj_aRpx5VNhp4/s320/onepage.png"/></a>
</div>
Here’s the memory map from the Cat tForth manual, which I have marked up
and corrected according to production models. The stock Cat officially
comes with 256K of main memory plus 8K of battery-backed RAM for storing
settings and the user dictionary. This was apparently 16K in earlier
iterations, and is 16K in MAME, but my system just has an 8K SRAM and
only an 8K SRAM is described in the official service manual. 512K is the
greatest amount of RAM supported by the hardware.
<p>
<p>The 256K system ROM is located at the bottom of the address space
with the lowest 1K being the 68K exception vector table, and above that
the battery-backed settings RAM from $040000 to $041fff. The main RAM
starts at $400000, which is also where the 28896-byte (~28K) 672x344
monochrome display bitmap is stored. From $600000 and up is the
memory-mapped I/O range, but we will rarely manipulate those devices
directly.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgU9sWUmSOYC5KkuhgtT2jexNZgxDHHRkWX2gURzdKBW8d-HtgR5I7HX2nrnOWMm8tZMVyTmDhsRlqKz68aSpvwk1O8MJcqcT8Smahg16Hxhi5f7ZOWWkFUUlxhtqo0iq0Kj0CXAJDHXpPXLVJ8QLllRqPwqXqEZ1kIesOv49sc9ZBEFjoN9UMyfCKO5xc/s672/0004.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgU9sWUmSOYC5KkuhgtT2jexNZgxDHHRkWX2gURzdKBW8d-HtgR5I7HX2nrnOWMm8tZMVyTmDhsRlqKz68aSpvwk1O8MJcqcT8Smahg16Hxhi5f7ZOWWkFUUlxhtqo0iq0Kj0CXAJDHXpPXLVJ8QLllRqPwqXqEZ1kIesOv49sc9ZBEFjoN9UMyfCKO5xc/s320/0004.png"/></a>
</div>
<p>From the Forth prompt you can do any Forth operation, including
defining new words, though long lines don’t wrap and complex words are
better defined within the editor. Here we’re storing a simple vertical
strip of bytes to video memory as a “hello world” (<tt>20 0 do i i 54 *
400000 + c! loop</tt>). The framebuffer is linear and byte-addressed
with 84 bytes for each 672 pixel line, and is white on black (i.e., set
pixels are white, unset pixels are black). Note that all values
displayed and entered are in hexadecimal by default.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKH1GLkI80uAnUDK3ISXGIQDCBV1WSuQsOeW2himTZAUYqdNnXtd5Iw5Zyb2NSLS3N07TDY-YN05kyQna5DWQJrQd86UizJ_nrVTO3uf79pLotYjlNiS3EiJpWn1Zce82_g8np-oSenwQKReHkkRQX9vD0KEuvxm1ZrPtXsEBksxJNTZY6zrKOzG4YMAw/s672/0000.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhKH1GLkI80uAnUDK3ISXGIQDCBV1WSuQsOeW2himTZAUYqdNnXtd5Iw5Zyb2NSLS3N07TDY-YN05kyQna5DWQJrQd86UizJ_nrVTO3uf79pLotYjlNiS3EiJpWn1Zce82_g8np-oSenwQKReHkkRQX9vD0KEuvxm1ZrPtXsEBksxJNTZY6zrKOzG4YMAw/s320/0000.png"/></a>
</div>
<p>Usually, the next thing you do in a new Forth environment after your
“hello world” or moral equivalent is ask what other words are around.
But here, by default, nothing shows.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEicItkRUZG4jNUdFIg8nDUzwOfpuvoSJedI-4vlV7I-whx8D08O6x8lMR9EgE8-oiRLjMeHjPAklYOGz36qCYZwZsh-YabdOa5MZIt4uybvFXX_0frH-xAGe05BtjehSWU0GSsUrgL6zDdycEgPAPgdVf8MSPgBO7AiJD6OhCZne7MoJcSADhYVmo9wseg/s672/0001.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEicItkRUZG4jNUdFIg8nDUzwOfpuvoSJedI-4vlV7I-whx8D08O6x8lMR9EgE8-oiRLjMeHjPAklYOGz36qCYZwZsh-YabdOa5MZIt4uybvFXX_0frH-xAGe05BtjehSWU0GSsUrgL6zDdycEgPAPgdVf8MSPgBO7AiJD6OhCZne7MoJcSADhYVmo9wseg/s320/0001.png"/></a>
</div>
<p>tForth has the concept of <i>vocabularies</i>, which are organized
into a tree and a search order, and the user can define additional ones.
The word <tt>existing</tt> tells us the present vocabularies, which are
<tt>function</tt>, <tt>arithmetic</tt>, <tt>user</tt>, <tt>hidden</tt>
and <tt>forth</tt>, all of which descend from <tt>forth</tt>, which is
the root. As shipped, however, this scheme is not greatly exploited: the
<tt>arithmetic</tt> vocab is completely empty, there are only a handful
of math and stat operations in <tt>function</tt>, and you obviously have
to add your own to <tt>user</tt>. Most of the ROM word action occurs in
<tt>hidden</tt>, which contains the words for the editor (and is hidden
from listings, but are all executable), and in <tt>forth</tt>, from
which all blessings flow. Although sixteen vocabularies may be in play
at any time, it doesn’t look like this capability was ever taken to its
fullest extent.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjD7qvc6JoBlx41FlSjzYMU_PbWwFDDCcFQccp50Vi5Yi09_wwz9bq_3UHtt-ilkUAuDZoZAYFdhip2d-DMKolEgFf1aZMdF7USx3Phg59X5hKw8qwhL0uHJ7MAS85njI2M_GyfFS3NsrhIrLUELNnehjXYEpue98PiphnCMVnBo1lHmYaQw9iPAYwRrKU/s672/0002.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjD7qvc6JoBlx41FlSjzYMU_PbWwFDDCcFQccp50Vi5Yi09_wwz9bq_3UHtt-ilkUAuDZoZAYFdhip2d-DMKolEgFf1aZMdF7USx3Phg59X5hKw8qwhL0uHJ7MAS85njI2M_GyfFS3NsrhIrLUELNnehjXYEpue98PiphnCMVnBo1lHmYaQw9iPAYwRrKU/s320/0002.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQmFvewGTIVndG5P-C8e9mru9mkhAdhjyZkqEMPPOueU4rk26HOOEYCbRlxIVtgYLfNMrjf-STa_1-_p8Uz-SLsXU712Udhg5hKSd2_0pP53lhcds6SAAFSQ8m-n0vaFteZBzjl6WaPUt6Krg8346O0kHRb3MPrlqCS5oPsSHz2i7osOQgPTNXYmi7NEw/s672/0007.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjQmFvewGTIVndG5P-C8e9mru9mkhAdhjyZkqEMPPOueU4rk26HOOEYCbRlxIVtgYLfNMrjf-STa_1-_p8Uz-SLsXU712Udhg5hKSd2_0pP53lhcds6SAAFSQ8m-n0vaFteZBzjl6WaPUt6Krg8346O0kHRb3MPrlqCS5oPsSHz2i7osOQgPTNXYmi7NEw/s320/0007.png"/></a>
</div>
We’ll mostly deal with the <tt>forth</tt> vocabulary, and the
<tt>new</tt> vocabulary, of course, because we’ll be adding words of our
own. However, the <tt>hidden</tt> vocabulary is absolutely present and
available and you needn’t explicitly open a vocabulary simply to use the
words in it.
<p>
<p>Also, you don’t need to try to read every word on this screen and
extract them from ROM either because I’ve already done it for you. Go
ahead and open up <a href="https://github.com/classilla/catbox">the
Github Catbox project</a> and refer to
<a href="https://github.com/classilla/catbox/blob/main/words">the handy
list of words</a>, including everything in the <tt>hidden</tt> vocab.
We’ll be using tools from the Catbox to do more spelunking in the ROM
very shortly.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhplwEYW9AtF-DvQZIF9aaX1Wqp0MqVosCUHnyJ6qQm22YeeOvt3aUoGMehqFPLoD3gaEdifNWgotdliH2JNCf7ApADTtnOsHWqkfl7ojoYCkGYj67GkUUzJiQLxE5Ga8IDrR6IlN92VV31mFcRcVPwm6jplWOUagf_FsIqoKH1ocLlju2g66f4SKvCsq8/s672/0000.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhplwEYW9AtF-DvQZIF9aaX1Wqp0MqVosCUHnyJ6qQm22YeeOvt3aUoGMehqFPLoD3gaEdifNWgotdliH2JNCf7ApADTtnOsHWqkfl7ojoYCkGYj67GkUUzJiQLxE5Ga8IDrR6IlN92VV31mFcRcVPwm6jplWOUagf_FsIqoKH1ocLlju2g66f4SKvCsq8/s320/0000.png"/></a>
</div>
<p>A couple more things about tForth before we get to talking about the
disk format. The <tt>‘</tt> word (a literal apostrophe, say “tick”)
tells you the token for any word, including words in ROM. As usual for
Forth, all words are (at least initially) executable machine code,
though some words are entirely so. You can use the token to do a lookup
and find where that code begins, or you can use the word <tt>c’</tt>
(“c-tick”) which will do that for you. The lookup is done in the
<i>token table</i>, which exists in RAM and whose location can
potentially vary, though on a 1.74 system the first address reliably
seems to remain at $410400 (not $40ec00 as in the memory map). The token
table gets initialized and copied into RAM as part of startup, making it
possible to patch ROM words if necessary to point to new in-RAM
definitions. <i>Spoiler alert: this will be necessary.</i> Here, we’ve
dumped some of the memory at <tt>cold</tt>’s execution address to
demonstrate it’s written in 68K assembly, as you would expect for
something that cold-starts the machine.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgaliQfedYKoUekjkxg9ieJnb6-mlr3M_iRxSFSQFkzrMphc_gWNBAdGRYJ-4lM-uGTJzLYOpDxoEzIh9un4IOC72RCrvdoH_zBiIWo2vzkN5ugyzhd_yqg1JuKwxW74UIa89nVxHUJ2xX2fBqriwwL8_VFE-QQPyxLvaS4TmGdytOipWlCbSOPro_W6T8/s672/0001.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgaliQfedYKoUekjkxg9ieJnb6-mlr3M_iRxSFSQFkzrMphc_gWNBAdGRYJ-4lM-uGTJzLYOpDxoEzIh9un4IOC72RCrvdoH_zBiIWo2vzkN5ugyzhd_yqg1JuKwxW74UIa89nVxHUJ2xX2fBqriwwL8_VFE-QQPyxLvaS4TmGdytOipWlCbSOPro_W6T8/s320/0001.png"/></a>
</div>
<p>But not every word in ROM is in assembler, just ones where
performance was important or direct code merely more expedient. The
<tt>save</tt> word, which we’ll be exploring a lot more later on, is
written in tForth. We know this because the first 68K opcode to get
executed is $4ed3 or <tt>jmp (a3)</tt>, calling the address in 68K
register A3, which during tForth execution contains the address for the
<i>nesting</i> routine. This block of native code saves the tForth
equivalent of the return address, computing it as a delta from the
calling word to the new word. It then does some other housekeeping, sets
the new tForth instruction pointer in A5 to the byte after the <tt>jmp
(a3)</tt> and falls through to the very critical <i>next</i> routine
(kept in A4), which grabs the execution address for the next word at the
A5 instruction pointer and jumps into it.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3sN0bRx2R3mURhLPJFcCHte7_Pp_ulBtf3PVGHqiFVK0AQ4SZpDzmCE3sh_7n6tQN4EtxPmZ4nWExPYjjxtZ_2X8iy_luEBkQOwICI4SfMBqJKUgtpyGjMkAms-TyKx5dUqgPwTQrt59Hx_fJ_ehpqajev30dIbvl3pKGsN85IAJjSAoszWbi_ersxUI/s672/0002.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3sN0bRx2R3mURhLPJFcCHte7_Pp_ulBtf3PVGHqiFVK0AQ4SZpDzmCE3sh_7n6tQN4EtxPmZ4nWExPYjjxtZ_2X8iy_luEBkQOwICI4SfMBqJKUgtpyGjMkAms-TyKx5dUqgPwTQrt59Hx_fJ_ehpqajev30dIbvl3pKGsN85IAJjSAoszWbi_ersxUI/s320/0002.png"/></a>
</div>
<p>For housekeeping, words in a vocabulary have <i>headers</i>, which
contain an encoded offset into the starting address table and the word’s
ASCII string with a length and flags byte. Only the first 32 bytes of a
word’s ASCII string are considered significant. The header for a word
can ordinarily be obtained with <tt>n’</tt> (“n-tick”) but words in ROM
don’t appear to have one. (In fact, they do, but the routines
intentionally? don’t look at that portion of ROM.)</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEikEBWZxPX_0FUWwZERH1Zf4feeCQ8OcB3ZKJiWf8v9cvlotQXY5X9sF23ZCsM619GHptnDslyhDX4NI8kImiuxzS-WgedNrAKqi_8sNKXaaC5FFTroIsy4AdgEkltlWnP_X9gSoDYtTaNo-ufD2dkoqE9HVG9gMuxa1NokkyMhyphenhyphengbn3Xk7Rp0d_GhMMEo/s672/0003.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEikEBWZxPX_0FUWwZERH1Zf4feeCQ8OcB3ZKJiWf8v9cvlotQXY5X9sF23ZCsM619GHptnDslyhDX4NI8kImiuxzS-WgedNrAKqi_8sNKXaaC5FFTroIsy4AdgEkltlWnP_X9gSoDYtTaNo-ufD2dkoqE9HVG9gMuxa1NokkyMhyphenhyphengbn3Xk7Rp0d_GhMMEo/s320/0003.png"/></a>
</div>
However, new words we define certainly have headers, like this more
canonical “hello world” example (<tt>: hello .” hello world” cr ;</tt>).
Here we can see it was given a token, see its execution address
(starting with <tt>jmp (a3)</tt>), and see its header containing the
encoded offset, then the length-and-flags byte, and then the string
<tt>hello</tt>, plus some trailing garbage (the entry ends right after
the string). The encoded offset and flags are mutable and can be changed
later.
<p>
That’s a sufficient understanding of tForth under the hood for what’s
coming up.
<p>
<h3>
Reading and writing Cat disks
</h3>
<p>
In <a href="/2024/05/refurb-weekend-canon-cat.html">our previous entry
on the Canon Cat hardware</a>, we shored up the Cat’s internal floppy
drive, which is a Canon-manufactured device specific to it. However, the
disks it uses are ordinary 3.5” floppy disks, and modern low-level
imaging tools can read them in a standard PC drive.
<p>
The basic rudiments of the format have been known for awhile thanks to
Dwight Elvey — if Raskin was the father of the Cat, then Elvey would
surely be its godfather — and
<a href="http://www.canoncat.net/cat/Cat%20Forth%20Inside.txt">his
notes</a> indicate the drive is writing regular 512-byte sectors, 10 per
track and 80 tracks per disk, single-sided. (Atari ST enthusiasts will
find this format familiar. While the ST by default stores only nine
sectors per track, it can store ten, such as on titles such as
<a href="https://www.filfre.net/2016/01/a-pirates-life-for-me-part-3-case-studies-in-copy-protection/">Dungeon
Master</a>.) That’s 400K a disk, and since the Cat only shipped with
256K and had additional RAM sockets only for 384K total, the entirety of
the supported RAM will fit. Both double-density and high-density 3.5”
floppies apparently work, though I have plenty of new-in-box DD floppies
here and we’ll use those.
<p>
<p>Since I wanted nice clean disks written on a good quality drive for
my Cat, I decided to go down to CompUSA and buy a new floppy drive
too.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjU2_9PaKMVzqgaOLxJ8DFil3L5gjBTHXZW6IERzrYJtpbv5rugoWb9xZtHePCjznVO2xGZqf1mEMpnyR1WDwQGP3HzZQ2HpgOMlL-Ydp3mwE_gC4j24BLiNSX5wqZ5whyxpEgviyf5m9ok-3JvLz_L0WYe0WJarvfNjtaD-MEn1Zw-C3NMlLW4MXoVrno/s4080/PXL_20240518_223828646~2%20%281%29.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjU2_9PaKMVzqgaOLxJ8DFil3L5gjBTHXZW6IERzrYJtpbv5rugoWb9xZtHePCjznVO2xGZqf1mEMpnyR1WDwQGP3HzZQ2HpgOMlL-Ydp3mwE_gC4j24BLiNSX5wqZ5whyxpEgviyf5m9ok-3JvLz_L0WYe0WJarvfNjtaD-MEn1Zw-C3NMlLW4MXoVrno/s320/PXL_20240518_223828646~2%20%281%29.jpg"/></a>
</div>
<p>Yeah, okay, eBay. But while I was looking for a new shrink-wrapped
drive I ran across this NOS CompUSA-boxed floppy drive package with
additional floppy disks and even a cleaning kit. The funny part is I do
remember buying one of these back in the day! I just don’t know where it
went, and I wanted a new one anyhow.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrs8yrkaps7oMLHLJdH4-fZhhUi00j6uWgcplAmIYbHQVeJjZOLNOpsS2ci8XL7raHujtY9wXQWUSqceMXa6UQeVWWyLClNrhKk2YDV7MELixZHU6FanxfRIZHxTPsSPQfTyZ1rLIRCjdefVNCjXzoXydWTGvVkSjDK1U1wRBhikFQvgXxTbNgUGIArtE/s4080/PXL_20240619_201355302%20%281%29.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgrs8yrkaps7oMLHLJdH4-fZhhUi00j6uWgcplAmIYbHQVeJjZOLNOpsS2ci8XL7raHujtY9wXQWUSqceMXa6UQeVWWyLClNrhKk2YDV7MELixZHU6FanxfRIZHxTPsSPQfTyZ1rLIRCjdefVNCjXzoXydWTGvVkSjDK1U1wRBhikFQvgXxTbNgUGIArtE/s320/PXL_20240619_201355302%20%281%29.jpg"/></a>
</div>
<p>The drive is one of the very common Teac FD-235 series. They are very
easy to find used, and, it turns out, new as well. The disk cleaner kit
went immediately to doing a few cycles on the Cat drive itself even
though the head looked pretty good when I inspected it.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgQqQ8hFRRUOsnW0qSwlHMYQr-EBZHymxQxp3jKCSc3CW9gp1CbiZiXU4ZKcSigJ2zkExYCtv0EdpYy2BpGbgFG0set2l0RJoJGHmakjxL4RSQZnfjjfi7uCk7bmihyZgQv5WiMLrEpm08UUhHzJH4a8Wo1mg6hUSc4zbV698uslR2GcNDY9IyI2ngsx_I/s4080/PXL_20240518_234205133%20%281%29.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgQqQ8hFRRUOsnW0qSwlHMYQr-EBZHymxQxp3jKCSc3CW9gp1CbiZiXU4ZKcSigJ2zkExYCtv0EdpYy2BpGbgFG0set2l0RJoJGHmakjxL4RSQZnfjjfi7uCk7bmihyZgQv5WiMLrEpm08UUhHzJH4a8Wo1mg6hUSc4zbV698uslR2GcNDY9IyI2ngsx_I/s320/PXL_20240518_234205133%20%281%29.jpg"/></a>
</div>
For our disk imaging we’ll use an off-the-hobbyist-shelf and inexpensive
<a href="https://github.com/keirf/greaseweazle">Greaseweazle</a>. These
USB-based devices have open source software for Linux, Windows and macOS
and are available from multiple sellers.
<p>
<p>Sadly, here’s where we leave MAME behind, since it doesn’t support
the floppy drive or disk images yet. Remember us typing <tt>Enable Forth
Language</tt>? Let’s make a disk out of that on the real Cat. The DISK
help screen looks like this:</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg0x_VZUqV82_iBtp-YDEe5sQikF0t9MB5a8-MW5oH44TwzpJLM2hKFBkbLNdu0SCGL8wOs6S5cbffTiKmX7TZta7E1sbr-SZygxYW29JdLe7yS2tWgwS0LF2FSNtH6_m9DkHDwV8CnMXYj_zdrNK_7f7BtWqyIQzIPh7B0nM76Y96Nst-SwyuFQ-E8UYc/s672/0011.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg0x_VZUqV82_iBtp-YDEe5sQikF0t9MB5a8-MW5oH44TwzpJLM2hKFBkbLNdu0SCGL8wOs6S5cbffTiKmX7TZta7E1sbr-SZygxYW29JdLe7yS2tWgwS0LF2FSNtH6_m9DkHDwV8CnMXYj_zdrNK_7f7BtWqyIQzIPh7B0nM76Y96Nst-SwyuFQ-E8UYc/s320/0011.png"/></a>
</div>
In short terms, if you have a blank disk in the drive and have unsaved
text in memory, then pressing USE FRONT-DISK will cause the Cat to
format the disk and save your document. However, the tForth
documentation also explains that all Forth words in RAM get written as
well, which is critical for our hackery. Ordinarily there wouldn’t be
any, of course, but it would if there were. Correspondingly, DISK will
also load a document and any associated words from a new disk as well,
though any disk access regardless of direction is still centered on the
editor — the Cat doesn’t run applications in the traditional sense.
(Spoiler alert: hang tight.)
<p>
But that’s not all it’s saving, though. If you read the DISK help
carefully, you’ll note it says something about showing “a sample of
what’s on the disk” if you have a different disk present. Ignoring the
question right now of how it determines which disk goes with what
workspace, how can it show the document on the floppy disk if the
entirety of RAM could be on it? Wouldn’t it overwrite the document in
memory?
<p>
Let’s dump this disk and investigate. It’s possible that the Canon drive
uses some weir-dass GCR format, but it turns out to our delight that
it’s regular MFM. Since we know it’s single-sided, there’s no need to
check both sides, and we can stop scanning at track 80. Thus, we can get
a read of the disk as a straight in-order sector dump with <tt>gw read
–format=ibm-scan –tracks=c=0-79:h=0 test.img</tt>.
<p>
<div class="tx">
<pre>
% gw read --format=ibm-scan --tracks=c=0-79:h=0 test.img
Reading c=0-79:h=0 revs=2
Format ibm.scan
T0.0: IBM MFM (10/10 sectors) from Raw Flux (91178 flux in 400.47ms)
T1.0: IBM MFM (10/10 sectors) from Raw Flux (91231 flux in 400.50ms)
[...]
T18.0: IBM MFM (10/10 sectors) from Raw Flux (85652 flux in 400.49ms)
T19.0: IBM Empty from Raw Flux (50039 flux in 400.50ms)
T20.0: IBM Empty from Raw Flux (50038 flux in 400.46ms)
[...]
T78.0: IBM Empty from Raw Flux (50043 flux in 400.51ms)
T79.0: IBM Empty from Raw Flux (50043 flux in 400.52ms)
Cyl-&gt; 0         1         2         3         4         5         6         7         
H. S: 01234567890123456789012345678901234567890123456789012345678901234567890123456789
0. 0: ...................                                                            
0. 1: ...................                                                            
0. 2: ...................                                                            
0. 3: ...................                                                            
0. 4: ...................                                                            
0. 5: ...................                                                            
0. 6: ...................                                                            
0. 7: ...................                                                            
0. 8: ...................                                                            
0. 9: ...................                                                            
Found 190 sectors of 190 (100%)
</pre>
</div>
<p>
An immediately interesting thing about this image dump is that each
track (cylinder)’s ten sectors are numbered 0-9, not 1-10 which is more
typical.
<p>
If we dump strings, we can find our text <tt>Enable Forth Language</tt>
near the end of the image. This makes sense since the text is stored in
the upper part of RAM, above the Forth dictionary. We can see some other
strings like <tt>-1 wheel! savesetup re</tt> presumably from when we
entered that command, though it appears earlier in the file.
<p>
We know that each track is 5120 bytes ($1400, 512 bytes times 10
sectors) long. The first track is 10 repeated sectors of
<p>
<div class="tx">
<pre>
00000000  00 00 81 2c 00 00 db c6  00 00 74 e0 00 00 74 c6  |...,......t...t.|
00000010  00 00 74 d4 00 02 c8 ea  00 40 7a e8 00 40 7c fc  |..t......@z..@|.|
00000020  00 00 00 2c 00 00 ff 81  00 00 00 11 00 00 ff ff  |...,............|
00000030  00 41 10 10 00 02 c8 d0  00 41 00 68 00 41 01 dd  |.A.......A.h.A..|
00000040  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
*
00000060  ff ff ff ff 20 08 33 26  00 11 ff ff ff ff ff ff  |.... .3&amp;........|
00000070  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
00000080  01 d7 3c 0c 00 42 00 00  00 00 00 ed 00 41 40 20  |..&lt;..B.......A@ |
00000090  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
000000a0  00 00 00 00 00 00 00 00  00 43 c0 28 ff ff ff ff  |.........C.(....|
000000b0  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
000000c0  ff ff ff ff 00 42 00 08  00 43 ac 00 00 42 06 8f  |.....B...C...B..|
000000d0  00 43 ab b4 00 43 ab b8  00 42 06 8e 00 00 00 00  |.C...C...B......|
000000e0  00 00 00 00 00 41 3f b4  00 42 00 00 00 43 ac 20  |.....A?..B...C. |
000000f0  00 41 38 00 00 00 00 00  00 04 00 10 ff ff ff ff  |.A8.............|
00000100  19 52 e5 78 43 7d 72 d2  dd d2 1a 46 10 9d f7 58  |.R.xC}r....F...X|
00000110  03 dc a6 13 88 75 16 74  00 00 00 00 00 00 00 00  |.....u.t........|
00000120  00 00 00 00 00 00 00 00  00 00 00 00 00 00 00 00  |................|
*
00000180  00 41 35 52 00 00 00 00  00 41 35 5a 00 00 00 00  |.A5R.....A5Z....|
00000190  00 41 35 62 00 00 00 00  00 41 35 6a 00 00 00 00  |.A5b.....A5j....|
000001a0  00 41 35 72 00 00 00 00  00 41 35 7a 00 00 00 00  |.A5r.....A5z....|
000001b0  00 41 35 82 00 00 00 00  00 41 35 8a 00 00 00 00  |.A5......A5.....|
000001c0  00 41 35 92 00 00 00 00  00 41 35 9a 00 00 00 00  |.A5......A5.....|
000001d0  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
*
00000200
</pre>
</div>
<p>
This repeated sector is called the <i>idblock</i> and appears in the
technical documentation for the Cat’s editor. Because this is a 68K,
everything is big-endian as G-d Himself intended, though a fair bit of
it is unused. It contains copies of the 68000 data and address registers
in the first 64 bytes, the 68000 status register, a two-bit disk format
ID ($3326 here, but an earlier $3325 format is also accepted) required
to identify the disk as written by a Cat, a number of tracks ($0011 ==
17, though we found nineteen), various editor state variables, a
128-byte disk identifier called the <i>idtable</i> (that’s how it knows
which workspace is what, though only about 24 bytes of it are actually
populated here), and then pointers for any keyboard macros that were
defined.
<p>
The documentation notes that backup idblocks appear elsewhere on the
disk as well. One of these is in the first sector of the second track.
After that we see a lot of binary data with some scattered snippets of
text (later comparison shows this is the contents of the SV-RAM), and
then starting with the first sector of the third track this peculiarly
familiar-looking pattern:
<p>
<div class="tx">
<pre>
00003c00  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
*
00003df0  ff ff ff ff ff ff ff ff  ff ff 55 55 55 55 55 55  |..........UUUUUU|
00003e00  55 55 55 55 55 55 55 55  55 55 55 55 55 55 55 55  |UUUUUUUUUUUUUUUU|
*
00003e40  55 55 55 55 55 55 55 55  55 55 ff ff ff ff aa aa  |UUUUUUUUUU......|
00003e50  aa aa aa aa aa aa aa aa  aa aa aa aa aa aa aa aa  |................|
*
00003e90  aa aa aa aa aa aa aa aa  aa aa aa aa aa aa ff ff  |................|
00003ea0  ff ff 55 55 55 55 55 55  55 55 55 55 55 55 55 55  |..UUUUUUUUUUUUUU|
00003eb0  55 55 55 55 55 55 55 55  55 55 55 55 55 55 55 55  |UUUUUUUUUUUUUUUU|
*
00003ef0  55 55 ff ff ff ff aa aa  aa aa aa aa aa aa aa aa  |UU..............|
00003f00  aa aa aa aa aa aa aa aa  aa aa aa aa aa aa aa aa  |................|
*
00003f40  aa aa aa aa aa aa ff ff  ff ff 55 55 55 55 55 55  |..........UUUUUU|
00003f50  55 55 55 55 55 55 55 55  55 55 55 55 55 55 55 55  |UUUUUUUUUUUUUUUU|
*
00003f90  55 55 55 55 55 55 55 55  55 55 ff ff ff ff aa aa  |UUUUUUUUUU......|
00003fa0  aa aa aa aa aa aa aa aa  aa aa aa aa aa aa aa aa  |................|
*
00003fe0  aa aa aa aa aa aa aa aa  aa aa aa aa aa aa ff ff  |................|
00003ff0  ff ff 55 55 55 55 55 55  55 55 55 55 55 55 55 55  |..UUUUUUUUUUUUUU|
00004000  55 55 55 55 55 55 55 55  55 55 55 55 55 55 55 55  |UUUUUUUUUUUUUUUU|
*
00004040  55 55 ff ff ff ff aa aa  aa aa aa aa aa aa aa aa  |UU..............|
00004050  aa aa aa aa aa aa aa aa  aa aa aa aa aa aa aa aa  |................|
*
00004090  aa aa aa aa aa aa ff ff  ff ff ff ff ff ff ff ff  |................|
000040a0  ff ff ff ff ff ff ff ff  ff ff ff ff ff ff ff ff  |................|
</pre>
</div>
<p>
<p>If you look at our screenshot for <tt>Enable Forth Language</tt>, you
see two 50% dithered grey blocks above and below it. Those are the
document separators. Anyone who’s messed around with the video memory in
a monochrome framebuffer will recognize the pattern of <tt>aa 55</tt> as
<tt>10101010 01010101</tt> — a 50% grey. Since we know our framebuffer
is linear and contiguous, let’s pull out the 28896 bytes (84 bytes per
line times 344 lines) from this offset and stick a Portable Bit Map
header on it. Guess what:</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJRklR_bMSEktVxzj97DZ-ETdDiJSisCi88O4kbaDHS9TFbeumpl5jwPeaez0VZbzpc0SjiuF1ST3PZCkFHm16DkfdGQFzsWA9ICMN6fCzAs6EECNrytXAaPWLXmayYRU4x06gReyFpaxiGyTAqNc2vW5LRxUmQd-6FD05SPm27eemMSZcGox4nn5ln2U/s672/testdisk.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJRklR_bMSEktVxzj97DZ-ETdDiJSisCi88O4kbaDHS9TFbeumpl5jwPeaez0VZbzpc0SjiuF1ST3PZCkFHm16DkfdGQFzsWA9ICMN6fCzAs6EECNrytXAaPWLXmayYRU4x06gReyFpaxiGyTAqNc2vW5LRxUmQd-6FD05SPm27eemMSZcGox4nn5ln2U/s320/testdisk.png"/></a>
</div>
That’s our text as a screenshot, just inverted, because PBM is black on
white. As the Cat also dumps video memory when it saves to disk, the
preview feature is nothing more than just loading it back. A clever
idea, too: it’s quick, it’s reversible with a repaint and it doesn’t
disturb anything else in memory. In fact, we can also see when fully
loading a document disk into the Cat that the preview image is loaded
into video memory as part of that process too (which gives the illusion
of it loading faster than it truly does). Moreover, the Cat doesn’t seem
to care what image data is there as long as it can read it.
<p>
So, as a test to make sure we can write our own arbitrary data to a Cat
floppy, let’s write something that can patch in a custom image. For the
picture data, I found a photo of Jef Raskin sitting at a desk in front
of a Cat, cropped and resized it to the right proportions, then crushed
and dithered it out to a ready PBM with <tt>magick raskin.png -resize
672x344! -dither FloydSteinberg -remap pattern:gray50 -negate
raskin.pbm</tt>.
<p>
Now we need a disk format we can master a new floppy from. This sector
dump, as easy as it was to parse, will not suffice for this purpose;
there’s not enough metadata about the sectors and tracks for the
Greaseweazle software to create the right geometry. We’d also like a
format that’s well-documented and higher-level than raw flux or raw MFM
because we know the Canon drive is writing renumbered but otherwise
normal sectors, and it will make the disk image easier to alter. And, of
course, the Greaseweazle software needs to support it. After reading
through the Greaseweazle wiki’s
<a href="https://github.com/keirf/greaseweazle/wiki/Supported-Image-Types">list
of supported formats</a>, I settled on the CPC
<a href="https://www.cpcwiki.eu/index.php/Format:DSK_disk_image_file_format">extended
DSK format</a> since it has a fully documented specification and was
likely to capture any unforeseen necessary nuances of the Cat’s format,
but still provides the actual sector data as decoded bytes. It can be
captured with a command line like <tt>gw read –format=ibm-scan
–tracks=c=0-79:h=0 test.edsk</tt>.
<p>
To verify viability, I captured the same floppy as eDSK and then wrote
it to another blank disk (<tt>gw write test.edsk</tt>), and checked if
the Cat would read that. It did!
<p>
However, moving to a higher fidelity format sometimes introduces
complications. One complication while reading test disks written by the
Cat was that some (not all) of them didn’t actually start on physical
track zero: they started on physical track two, leaving physical tracks
zero and one unformatted, even though the track as written
<em>claimed</em> to be track zero. I wasn’t sure of the significance of
this at the time — we’ll revisit this later. Interestingly, the eDSK
format also revealed that <em>every</em> sector on track zero is tagged
as sector one, all ten of them, probably to speed up checking if the
idtable on disk matches the current workspace or not since any sector
will do.
<p>
The second complication is that we no longer get sectors in logical
order but rather in the physical order they appear on disk, which may or
may not match. The Cat doesn’t seem to write tracks with any particular
interleave, so to read and write the eDSK sectors we’ll need to consult
the Track Information Block (TIB) for each track to determine which
sector is at which offset.
<p>
<p>In the Catbox are two Perl tools,
<a href="https://github.com/classilla/catbox/blob/main/catrpic"><tt>catrpic</tt></a>
that will extract a PBM-format image from a Cat eDSK image (emitting the
picture to standard output), and
<a href="https://github.com/classilla/catbox/blob/main/catwpic"><tt>catwpic</tt></a>
that will take a PBM-format image of the right dimensions and insert it
into a Cat eDSK (emitting the hybrid eDSK to standard output). You’ve
seen this picture before, but here it is again, the Cat loading from
this modified disk image:</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhoYUTdpZ926bg2y1uhIt_RXDsPTSciNviBj2K_VpYbLm5WRG5vlHnL178BM4GX5Z4IErhHurAlRjwh52810hRxu1819vTZoFFc8c4QTqxZt73WpaADk_Q83_aYVwWeB7DKxWg-feQENgo57w9qkoVtOLS3sdifL7FfEsxMebLW7pKW2ksVouP5PEjJtiA/s4080/PXL_20240524_195905228.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" height="320" data-original-height="4080" data-original-width="3072" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhoYUTdpZ926bg2y1uhIt_RXDsPTSciNviBj2K_VpYbLm5WRG5vlHnL178BM4GX5Z4IErhHurAlRjwh52810hRxu1819vTZoFFc8c4QTqxZt73WpaADk_Q83_aYVwWeB7DKxWg-feQENgo57w9qkoVtOLS3sdifL7FfEsxMebLW7pKW2ksVouP5PEjJtiA/s320/PXL_20240524_195905228.jpg"/></a>
</div>
Unfortunately there’s not much else on this disk to load, so the picture
doesn’t stay on screen for very long. To rectify that we’ll have to
figure out how to make the Cat automatically run code from a disk.
Spoiler alert: <i>there’s a way to make the Cat automatically run code
from a disk.</i>
<p>
<h3>
Hack No. 1: The Jef Raskin Picture Disk
</h3>
<p>
In fact, some of you may have already realized how. Let’s look at the
idblock again, in which I mentioned the first 64 bytes are an image of
the 68K data and address registers, eight each. In the 68000
architecture register A7 is the stack pointer. Because we have control
of the stack pointer, we have control of the CPU’s return address: if we
change A7 in the idblock to another location, we can store a different
return address there, and on the next <tt>RTS</tt> we’ll take over the
CPU. This isn’t a flaw in the Cat’s operating system, by the way — think
of it more like <a href="https://github.com/4g3v/steelhax">save-file
hacking</a>, except that there’s no ASLR or execute protection, so once
you’re in, you’re in.
<p>
Reprising our disk’s idblock, A7 is marked in bold:
<p>
<div class="tx">
<pre>
00000000  00 00 81 2c 00 00 db c6  00 00 74 e0 00 00 74 c6  |...,......t...t.|
00000010  00 00 74 d4 00 02 c8 ea  00 40 7a e8 <b>00 40 7c fc</b>  |..t......@z..@|.|
00000020  00 00 00 2c 00 00 ff 81  00 00 00 11 00 00 ff ff  |...,............|
00000030  00 41 10 10 00 02 c8 d0  00 41 00 68 00 41 01 dd  |.A.......A.h.A..|
00000040
</pre>
</div>
<p>
That location $407cfc is past the end of display memory at $4070e0 but
before the variable area declared to start at $40a280, so we can
hypothesize the processor stack normally lives somewhere in this range
(the tForth memory map calls this block part of the display memory, but
it doesn’t appear onscreen).
<p>
The Cat editor documentation provides two words that control saving and
loading from a disk: <tt>save</tt> and <tt>restore</tt>. In the Catbox I
wrote up <a href="https://github.com/classilla/catbox/blob/main/fdis">a
tForth ROM disassembler in Perl called <tt>fdis</tt></a> that works with
the 1.74 ROMs (recovered tForth source code also exists for this, but
you can be confident you’re seeing exactly what’s being run by pulling
from the ROM). If you’ve got the MAME ROMs, unzip <tt>cat.zip</tt> and
convert the 1.74 ROMs from interleaved to continuous using
<a href="https://github.com/classilla/catbox/blob/main/interleave_rom">the
Catbox’s <tt>interleave_rom</tt> tool</a>, like so:
<p>
<div class="tx">
<pre>
% ./interleave_rom r74*.ic[24] &gt; rom
% ./interleave_rom r74*.ic[35] &gt;&gt; rom
</pre>
</div>
<p>
Now we can use <tt>fdis</tt> to walk the ROM and print out the tForth
opcodes for a given token (if it’s a variable or 68K code, it will say
so instead). We’ll start with the <tt>restore</tt> routine, since we’re
trying to intercept loading. It appears deceptively short:
<p>
<div class="tx">
<pre>
% ./fdis rom restore
token = 0x016b
0002cb88 1128 cstate
0002cb8a 65   off
0002cb8b 0305 &lt;restore&gt;
0002cb8d ff   don
0002cb8e 4e   raddr
0002cb8f d3   emit
0002cb90 120c lastop
0002cb92 14e8 %disk
0002cb94 7c   =
0002cb95 26   &lt;;&gt;
</pre>
</div>
<p>
<p>Yes, words can have angle brackets in them or indeed any symbol other
than whitespace. The meat appears to be in the word
<tt>&lt;restore&gt;</tt>, but the editor technical documentation says
it’s tricky:</p>
<blockquote>
The word <tt>&lt;restore&gt;</tt> reads useful information from the
idblock (already read from the disk by the Disk command … After this, it
reads the display memory, immediately displaying it on the screen. Then
it reads the remaining off-screen contents of the disk into memory.
<p>
It then executes the second half of <tt>&lt;save&gt;</tt> by use of a
non-standard programming method. The entire machine state, including
return stack, program counter and instruction pointer, is recorded. When
it is restored (copied back into memory), execution resumes where it
left off when <tt>&lt;save&gt;</tt> began writing the image into memory.
This creates an unusual situation.
<p>
The same code (in the second half of <tt>&lt;save&gt;</tt> is used by
both <tt>save</tt> and <tt>&lt;restore&gt;</tt>.
</blockquote>
The text isn’t quite accurate because the PC is not, in fact, part of
the idblock, but it does tell us most of the action is actually in
<tt>&lt;save&gt;</tt>. The reason both operations exit through common
code is because the save operation compacts the dictionary and working
text in memory before writing them out, so both the restore and save
operations must unpack them before returning to the editor — in the
restore case, after loading it from disk, and in the save case, after
writing it. This particular word has a somewhat lengthy definition and
we’re going to tear it apart later, but we can see right in the
beginning of <tt>&lt;save&gt;</tt> that the magic is done by a 68K
assembly routine:
<p>
<div class="tx">
<pre>
% ./fdis rom "&lt;save&gt;"
token = 0x0304
0002c8d2 0433 notepointers
0002c8d4 0151 packforth
0002c8d6 0435 packtext
0002c8d8 0434 noteramsize
0002c8da 21   wlit 0x3326
0002c8dd 22   lit 0x00407666
0002c8e2 5b   w!
0002c8e3 0106 recal
0002c8e5 e5   ?diskerror
0002c8e6 21   wlit 0x812c
0002c8e9 dd   call
[...]
</pre>
</div>
<p>
This is calling a ROM routine at $812c. This routine, in part, starts by
capturing the CPU registers:
<p>
<div class="tx">
<pre>
 00812C  move    SR, $407664.l                               40F9 0040 7664
 008132  movem.l A0-A7, $407600.l                            48F9 FF00 0040 7600
 00813A  movem.l D0-D7, $407620.l                            48F9 00FF 0040 7620
</pre>
</div>
<p>
which is used for the memory image of the outgoing idblock starting at
$407600. When the restore runs, another 68K ROM routine is called at the
end of <tt>&lt;restore&gt;</tt> after loading everything:
<p>
<div class="tx">
<pre>
% ./fdis rom "&lt;restore&gt;"
token = 0x0305
0002ca6c d4   cls
0002ca6d 0106 recal
0002ca6f e5   ?diskerror
0002ca70 0109 idblock
[...]
0002cb5b 21   wlit 0x8368
0002cb5e dd   call
0002cb5f 55   1
0002cb60 37   &lt;"&gt; "Unable to restore text from disk."
0002cb83 38   &lt;abort"&gt;
0002cb84 26   &lt;;&gt;
</pre>
</div>
<p>
The ROM routine it calls at $8368 finishes by restoring those registers
from the in-memory idblock.
<p>
<div class="tx">
<pre>
 008368  move    #$2700, SR                                  46FC 2700
 00836C  clr.l   $40723c.l                                   42B9 0040 723C
 008372  movea.l $40fdfc.l, A0                               2079 0040 FDFC
 008378  move.l  A0, $40725c.l                               23C8 0040 725C
 00837E  movea.l #$407260, A1                                227C 0040 7260
 008384  move.l  #$265, D0                                   203C 0000 0265
 00838A  move.b  (A0)+, (A1)+                                12D8
 00838C  dbra    D0, $838a                                   51C8 FFFC
 008390  move.l  $410068.l, $407230.l                        23F9 0041 0068 0040 7230
 00839A  movea.l #$407800, A0                                207C 0040 7800
 0083A0  move.w  $407668.l, D0                               3039 0040 7668
 0083A6  move.l  $40fbd0.l, D1                               2239 0040 FBD0
 0083AC  lea     ($6,PC) ; ($83b4), A1                       43FA 0006
 0083B0  jmp     $7e5e.w                                     4EF8 7E5E
 0083B4  move.l  D0, $407238.l                               23C0 0040 7238
 0083BA  beq     $83cc                                       6710
 0083BC  move.l  #$12345678, $40723c.l                       23FC 1234 5678 0040 723C
 0083C6  jmp     $3210c.l                                    4EF9 0003 210C
 0083CC  movem.l $407600.l, A0-A7                            4CF9 FF00 0040 7600
 0083D4  movem.l $407620.l, D0-D7                            4CF9 00FF 0040 7620
 0083DC  move.l  $40725c.l, $40fdfc.l                        23F9 0040 725C 0040 FDFC
 0083E6  move    $407664.l, SR                               46F9 0040 7664
 0083EC  rts                                                 4E75
</pre>
</div>
<p>
Assuming no error condition is detected, this routine has the effect of
restoring the stack pointer and all registers, including the state of
the tForth VM which is entirely stored in registers, to point to the
tForth word after the call to $812c in <tt>&lt;save&gt;</tt>. I note for
completeness that this call actually occurs in two places, but both are
in the first part of the word, so the second part of
<tt>&lt;save&gt;</tt> is executed regardless. (The <tt>LEA</tt> and
<tt>JMP</tt> idiom at $83ac is a fast way of doing a subroutine call by
not pushing to the stack and appears frequently in the Cat ROM.)
<p>
Now that we know where it comes out, and since we know restoring the
previous stack pointer will eventually return to the editor, we can
insert a diversion: during the loading process we’ll have the user press
a key to continue, so that they can appreciate our splendidly rendered
image, and then return to the editor via the rest of
<tt>&lt;save&gt;</tt>. Let’s make this a picture disk, complete with
<a href="https://en.wikipedia.org/wiki/Jef_Raskin">Jef Raskin’s
Wikipedia entry</a>, so that you can read his biography using the Cat he
designed. It should show his picture, wait for the user’s admiration,
and then load the article which can be then scrolled and searched with
the LEAP keys.
<p>
<p>For the text, we’re going to take advantage of the serial port to
load the document for us. I used Lynx to download and render the
Wikipedia text to 80-column plain text, cleaned it up in a text editor,
and added some instructions.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhNOdgLpOuycktUNdkGDZfryFaTaIUfKefIC77-ZAlVVOTVtkXJNrbPPIweQsWg3nmWfeonx4IUouo3VOI2y-ynyQp6y_o2EM7vRwcjlW2QB-bjttmwgZYxR6xvY-t7udxLmmdOZJ6FnuxAke-hQ_fVe3Df5c4VhuP1A0HxQlMHc_7tg7X0UtWSR4TNsCI/s4080/PXL_20240519_000006289.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhNOdgLpOuycktUNdkGDZfryFaTaIUfKefIC77-ZAlVVOTVtkXJNrbPPIweQsWg3nmWfeonx4IUouo3VOI2y-ynyQp6y_o2EM7vRwcjlW2QB-bjttmwgZYxR6xvY-t7udxLmmdOZJ6FnuxAke-hQ_fVe3Df5c4VhuP1A0HxQlMHc_7tg7X0UtWSR4TNsCI/s320/PXL_20240519_000006289.jpg"/></a>
</div>
<p>The next step is to transmit it. Oddly enough, the serial connection
does <em>not</em> use a null modem: use a straight-thru DB-25 male on
the Cat end to DE-9 (“DB-9”) female on your workstation’s end, with your
favourite USB to RS-232 dongle if you need it. The serial port on the
Cat is between the printer port and the phone jacks.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDm4fL2fF2iGRU9vtx7sbsX4J_bVavCSsek2VWDZ4eQhLMDhl2VUZdsnsZo9LHX1dvEFjNUvlvG8YhSQgerFg7hyFUJnZyRk_iURh6Lby84CyeVvXc5ZSwPjzT7SFRoqLVAvQj6ZyCm9nTaUrjJGNpea06oSDVB-2R4GL-IhQ_i2CXOGr_BVO_FsJ7Ih0/s4080/PXL_20240519_013400751.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjDm4fL2fF2iGRU9vtx7sbsX4J_bVavCSsek2VWDZ4eQhLMDhl2VUZdsnsZo9LHX1dvEFjNUvlvG8YhSQgerFg7hyFUJnZyRk_iURh6Lby84CyeVvXc5ZSwPjzT7SFRoqLVAvQj6ZyCm9nTaUrjJGNpea06oSDVB-2R4GL-IhQ_i2CXOGr_BVO_FsJ7Ih0/s320/PXL_20240519_013400751.jpg"/></a>
</div>
<p>By default the serial port is used as an alternate printer port, so
in the Setup screen we’ll switch it to the “SEND Command” (used for
serial communications) and “Full Duplex” with “CR/LF” for your line
terminator at 9600bps, 8-N-1. (The serial port is not supported in MAME
yet either.)</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi5WTGYLnKqU6MY_cOrlDwU7puuj3QIMCuQq2xIiz7ZPWYVldGCfmsZEifUGpH2x36CYitiS7R3xc7xW6yi3lHBK6P9egLwL9bkesl9Cx-QPX5qxqXDCwQIhhNPTxasftNRQ_kqecTpjay4hyphenhyphenwP-747l7IAXH6INQ07IVmEpZDxxNIqFPhRZ4OWbecpjGw/s4080/PXL_20240527_030806947.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi5WTGYLnKqU6MY_cOrlDwU7puuj3QIMCuQq2xIiz7ZPWYVldGCfmsZEifUGpH2x36CYitiS7R3xc7xW6yi3lHBK6P9egLwL9bkesl9Cx-QPX5qxqXDCwQIhhNPTxasftNRQ_kqecTpjay4hyphenhyphenwP-747l7IAXH6INQ07IVmEpZDxxNIqFPhRZ4OWbecpjGw/s320/PXL_20240527_030806947.jpg"/></a>
</div>
<p>Next we’ll widen the margins to the full 80 columns (USE FRONT-LEFT
MARGIN and LEAP LEFT, then USE FRONT-RIGHT MARGIN and LEAP RIGHT).</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilkZ1cAE_dq5lcDeAB2qo1XmV4xS1HkAF8I3OQ_MtioneL930TNJTao1qIz9T7gGbekf3o5YALX-o-0D-3BvA1cPmoxZzlSqh9-leOY-odfuTXGb6XSyg958fOzeCuGVhFGOltDfB_eze-b9PUgdgkXqy0DQhRBDg3JfqPgs3N3RmqwZDSkrQHKcf-4t4/s4080/PXL_20240527_031056506.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEilkZ1cAE_dq5lcDeAB2qo1XmV4xS1HkAF8I3OQ_MtioneL930TNJTao1qIz9T7gGbekf3o5YALX-o-0D-3BvA1cPmoxZzlSqh9-leOY-odfuTXGb6XSyg958fOzeCuGVhFGOltDfB_eze-b9PUgdgkXqy0DQhRBDg3JfqPgs3N3RmqwZDSkrQHKcf-4t4/s320/PXL_20240527_031056506.jpg"/></a>
</div>
You may have noticed the absence of flow control options in the Setup
screen, and that’s because the Cat only supports software flow control
with XON/XOFF. (This will be relevant in the third hack.) Sending the
text full blast will drop characters because the CPU has to wrap and
format it as text arrives.
<p>
<p>To avoid this problem, you could obviously use a terminal program
that supports XON/XOFF, or you could simply send data with a slight
delay after each character. I provide
<a href="https://github.com/classilla/catbox/blob/main/sendfile.c">just
such a program (written in C)</a> in the Catbox; compile it with
something like <tt>gcc -O2 -o sendfile sendfile.c</tt>. To send the file
with a 10ms intercharacter delay, use a command line like <tt>sendfile
/dev/ttyUSB0 9600 raskin.txt 1,10</tt> which says to use
<tt>/dev/ttyUSB0</tt> at 9600 baud, sending <tt>raskin.txt</tt> with
10ms after every one character. Here the POWER9 Linux workstation is
pushing the document to the Cat which streams as characters are received
to the screen. Make sure text you transmit this way has CR-LF line
endings (e.g., <tt>set ff=dos</tt> in <tt>vim</tt>).</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgfT_TzYtE1B5nF27Yq5uDReCTZKCyiVSlkjas3ru4efnopjxKEU7nHdudqcP1-q-bOlIbz_1O0Onh-KNLwvSp7ttN4GZehqmaOnMnUCX7ZfAed-a7ulnKPBbrVLhI7VcSwsnZSJVdy_FYYWYwXuEhC8zoHMyV54xEDaPXfLNiJypVtY3_I8OZsZ6xpFZk/s4080/PXL_20240527_031540795.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgfT_TzYtE1B5nF27Yq5uDReCTZKCyiVSlkjas3ru4efnopjxKEU7nHdudqcP1-q-bOlIbz_1O0Onh-KNLwvSp7ttN4GZehqmaOnMnUCX7ZfAed-a7ulnKPBbrVLhI7VcSwsnZSJVdy_FYYWYwXuEhC8zoHMyV54xEDaPXfLNiJypVtY3_I8OZsZ6xpFZk/s320/PXL_20240527_031540795.jpg"/></a>
</div>
With the document loaded, we’ll lock it against editing by pressing
DOCUMENT LOCK and save it to disk with USE FRONT-DISK. The disk is
blank, so it saves it immediately, after which we image it to an eDSK.
<p>
Now for the executable portion. Obviously we could write this code in
68K assembly, but we have a limited amount of space before potentially
running into the <em>real</em> stack and we’d like to keep the code as
small as possible. That means writing it in tForth, so we need a means
to jump back into tForth and have the VM run anonymous code that is not
actually stored as a “real” word.
<p>
As it happens, tForth supports this as part of the <tt>goto</tt> word,
which directly executes “naked” tForth code from memory given an
execution address. It does this using a special reserved word called
<tt>temp</tt>. <tt>temp</tt>’s definition ordinarily is simply to return
an error message:
<p>
<div class="tx">
<pre>
% ./fdis rom temp
token = 0x00f8
0000dc52 55   1
0000dc53 37   &lt;"&gt; "unassigned token "
0000dc66 38   &lt;abort"&gt;
0000dc67 26   &lt;;&gt;
</pre>
</div>
<p>
The <tt>&lt;abort”&gt;</tt> word takes a condition and a string, and if
the condition is true, displays the string as an error and aborts. As
the default definition pushes a literal 1 to the stack as the first
value, running this word under normal circumstances will immediately
raise an error and halt. But remember that the token table is in RAM and
therefore mutable. The <tt>goto</tt> word exploits this fact:
<p>
<div class="tx">
<pre>
./fdis rom goto
token = 0x00fe
0000dbbe 21   wlit 0x00f8
0000dbc1 92   +table
0000dbc2 5c   !
0000dbc3 f8   temp
0000dbc4 26   &lt;;&gt;
</pre>
</div>
<p>
The word <tt>+table</tt> is 68K code that takes the given token value
(it’s $f8 here, which we know is <tt>temp</tt>) and returns the location
of its execution address in the token table, basically multiplying it by
4 and adding the base address. This gets called a lot, so it needs to be
fast. In practice the address it yields appears to be constant and
predictable, so the execution address for <tt>temp</tt> will always be
located in the token table at $4107e0 on a 1.74 ROM system. It then
stores the new address — presto, the word is redefined — and calls it.
The tForth technical docs warn that the code must end with a
<tt>next</tt> token instead of the usual <tt>&lt;;&gt;</tt> for proper
continuation, which we can accommodate. To run the new chimaeric
<tt>temp</tt>, we’ll call the Forth word <tt>execute</tt>, which is a
68K ROM routine residing at $d5ea that takes the token value and token
table address of a word and runs it.
<p>
The 68K assembly equivalent of this is straightforward, which we’ll call
our <i>trampoline</i>. We’ll change A7 in every copy of the idblock in
the eDSK to point to a new 32-bit address which points to the word after
that, where our machine code payload will reside, followed by our tForth
tokens. Since we know where the display is on disk and we know the
framebuffer ends in the middle of a sector (28896 is not an even
multiple of 512), we have 288 extra bytes in that sector to insert the
code right there and still remain reasonably clear of the <em>real</em>
stack. This address could be $4070e0, immediately after the display
ends, but since things can get pushed temporarily it’s better to move it
down a bit so garbage doesn’t spill onto the bottom of the screen (I use
$407120 which gives a 64-byte red zone). The code looks like this, which
we compute at the time we patch the eDSK:
<p>
<div class="tx">
<pre>
00407120 address pointing to entry 0040 7124
entry:
00407124 movea.l #OLD_A7,a7        2E7C OLD_ A7__
0040712a movea.l #$4107e0,a1       227C 0041 07E0
00407130 move.l #target,(a1)       22BC 0040 7142
00407136 move.l #$000000f8,d0      203C 0000 00F8
0040713c jmp $0000d5ea             4EF9 0000 D5EA
target:
00407142 jmp (a3)                  4ED3
; tforth tokens follow
</pre>
</div>
<p>
We restore the old A7 value, store the address of our payload
(<tt>target</tt>) to <tt>temp</tt>’s entry in the token table and
leaving the entry’s address in A1, load the token for <tt>temp</tt> to
D0 and jump into <tt>execute</tt>. I chose to use full 32-bit long
encodings for the parameters to make it easier to adjust for other ROM
versions with different addresses and token values. Notice that our
payload looks just like a regular tForth word, starting with the call
into the nesting routine. The D0 and A1 registers belong to a volatile
set used for arguments to ROM routines and are not part of the tForth
register state, so we can clobber them with impunity. We changed no
other relevant register other than A7 and we immediately set it back, so
we have not changed anything else other than to divert into our own
code. When our tForth block finishes, our cuckoo word will be unnested
and we’ll fall right back into <tt>&lt;save&gt;</tt> to complete the
restore process as if we never left it.
<p>
Finally, the tForth itself, which immediately follows the machine code
trampoline. The <tt>&lt;demit&gt;</tt> word will draw text to the
display at the given address; if the text has the high bit set, it will
render it in reverse video. Bold or normal text is determined by what
was used the last time a character was displayed, though for this
purpose either weight works. The code we want to execute is <tt>” press
any key” over + swap do i c@ i 407106 - 17 &lt;demit&gt; loop beep key
drop next ;</tt> which will put a string on the stack with its length,
loop over it and display each character, beep once, wait for a key,
throw it away and then exit as <tt>goto</tt> requires through
<tt>next</tt>. We could look the tokens up by hand, but we also can just
define it to a throwaway word and dump from its execution address using
<tt>c’</tt>.
<p>
<p>Our patcher will insert all of this into the 288 bytes at the end of
display memory on disk. Since most of you don’t have a Cat, here’s a
video of the picture disk in action.</p>
<div class="separator" style="clear: both; text-align: center;">
<iframe allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" width="320" height="266" src="https://www.blogger.com/video.g?token=AD6v5dw71XvItypYPPquDq9cBa_Ix4Fok5ihqJXWboh4T9xxUluuB7WPId5iOz2ouUoN3uBZZaCVbJFOV21yzZFNPQ" class="b-hbp-video b-uploaded" frameborder="0">
</iframe>
</div>
We turn on the Cat, insert the Raskin picture disk and press USE
FRONT-DISK. The disk loads, displaying our picture, and pauses with
“press any key” and a beep. (The disk light remains on as a side effect
since we haven’t yet run the word that turns the disk drive off.) We
press a key, loading completes, and the document appears. Next, we use
SHIFT and the LEAP keys to scroll line by line, then LEAP to the word
“Apple” forwards and back a few times (using USE FRONT-LEAP to leap
again with the same search), LEAP to the word “Aza,” and finally LEAP to
the DOCUMENT/PAGE marker, which will eventually bring us at the bottom
of the text. Sorry about the darkness and changing light levels, but
it’s hard to video a CRT with a Pixel 7 Pro.
<p>
The picture disk image is
<a href="https://github.com/classilla/catbox/tree/main/examples/raskin">in
the Catbox</a>. The patching program we’ll unveil at the end, since
we’re going to add more to it for the next couple hacks. Speaking of!
<p>
<h3>
Hack No. 2: CatTerm
</h3>
<p>
There are a couple downsides to what we just pulled for Hack No. 1, all
due to the fact we temporarily deviate from the restore process before
it completes. One minor drawback is that the floppy disk drive is still
active during code execution as the drive motor hasn’t been turned off
yet. But the big one is our limited execution area: the Forth dictionary
and document workspace are not unpacked until the end of loading, so the
technique we just used can only run within the small space provided and
can’t call longer words we create, only ones already in ROM.
<p>
That means we have to let the loading process finish to run larger
words, but if we do that naïvely then the Cat will still wind up in the
editor and never run our code. Altering the execution address for
<tt>&lt;save&gt;</tt> in the token table won’t help us because it’s
already in motion, and we can’t change the code that’s executing …
unless we copy <tt>&lt;save&gt;</tt> to RAM and run <em>that</em> as the
payload to our trampoline.
<p>
Here’s the rest of <tt>&lt;save&gt;</tt>, including the second call to
$812c. Either way we’ll end up in common code at $2c900 assuming no
errors.
<p>
<div class="tx">
<pre>
0002c8f5 7e   0=
0002c8f6 3a   and
0002c8f7 2b   &lt;0bran&gt; 0x08 (0x0002c900)
0002c8f9 0106 recal
0002c8fb e5   ?diskerror
0002c8fc 21   wlit 0x812c
0002c8ff dd   call
0002c900 15fc system.status
0002c902 20   blit 0x18
0002c904 66   +
0002c905 58   @
0002c906 10d4 trkbuf
0002c908 61   to
0002c909 15fc system.status
0002c90b 20   blit 0x1c
0002c90d 66   +
0002c90e 58   @
0002c90f 1854 ramend
0002c911 61   to
0002c912 22   lit 0x00407230
0002c917 58   @
0002c918 1868 t#on
0002c91a 61   to
0002c91b 06d1 parksafe
0002c91d 0100 doff
0002c91f 0436 unpacktext
0002c921 21   wlit 0x0088
0002c924 010a @ptr
0002c926 11b0 text
0002c928 0152 unpackforth
0002c92a 22   lit 0x00407700
0002c92f 1574 idtable
0002c931 21   wlit 0x0080
0002c934 8a   move
0002c935 21   wlit 0x00a0
0002c938 010a @ptr
0002c93a 13dc idadvance
0002c93c 61   to
0002c93d 54   0
0002c93e 0592 getdata
0002c940 54   0
0002c941 06b4 oldsetdata
0002c943 21   wlit 0x0100
0002c946 8a   move
0002c947 06c5 setupcat
0002c949 0279 resetcursor
0002c94b 0205 initruler
0002c94d 0209 checkline#
0002c94f 020b checkgauge
0002c951 020c checkbattery
0002c953 0492 resetphonelight
0002c955 0495 checklocallight
0002c957 0336 rule
0002c959 14e8 %disk
0002c95b 1210 curop
0002c95d 61   to
0002c95e 22   lit 0x00407238
0002c963 58   @
0002c964 2b   &lt;0bran&gt; 0x07 (0x0002c96c)
0002c966 11fc dirtytext?
0002c968 64   on
0002c969 0741 verifyerror
0002c96b 9d   error
0002c96c 48   ?dup
0002c96d 2b   &lt;0bran&gt; 0x05 (0x0002c973)
0002c96f 11fc dirtytext?
0002c971 64   on
0002c972 e5   ?diskerror
0002c973 26   &lt;;&gt;
</pre>
</div>
<p>
The goal is to add code after the <tt>?diskerror</tt> word at $2c972
(which aborts on errors) and before the end of the definition at $2c973.
At that point the Cat’s state is fully restored and expanded from disk
but the editor has not yet been entered. Our tForth payload therefore
becomes a copy of everything from $2c900 to $2c972 inclusive, followed
by pushing our word’s token value with a <tt>wlit</tt> literal word and
<tt>execute re &lt;;&gt;</tt> with the explicit terminal call to
<tt>re</tt> cleaning up any residual leftovers. Mercifully, the branches
are relative and need not be relocated, and with the stack padding and
trampoline it still fits in the 288 bytes available, so we just spew out
the same tokens otherwise.
<p>
This idea has a lot of possibilities. For example, you could write up a
word to automatically execute from the disk to patch up editor words in
the token table for additional features, or install a utility, or even
take over the system entirely. (Spoiler alert: stay tuned.) So for this
second hack, we’re going to do something useful for a change: a simple
terminal program for the Cat. But wait, you say, doesn’t the Cat already
have the capability to send and receive serial data from the editor? It
does, but it’s not very asynchronous: you have to highlight and manually
send text (using SEND) and you can’t just type to the remote system, and
individual keystrokes are particularly inconvenient. Plus, maybe you
just don’t want your entire transcript in your document, especially if
you’re running low on space.
<p>
<p>As in the first hack, we’ll load the tForth source over the serial
port. Here it is:</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi7kVXL1QE6P943qslDf_l6kCFScQxXZcLls_u8ui-zw1pb2MyMOimpYsJ5n4uISDiK2S3iqxQ1WU6Bxx2B6rgRtm05X6EpC4bsocUq_LLbC0As05PFemN-TuhOHjPYrjmwLdAlhHw_McQG18L-EhsXrJXNe3V7XvzOMaHZ-_RaeXTlIEDiC4FMauI6xUQ/s4080/PXL_20240527_063302869.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi7kVXL1QE6P943qslDf_l6kCFScQxXZcLls_u8ui-zw1pb2MyMOimpYsJ5n4uISDiK2S3iqxQ1WU6Bxx2B6rgRtm05X6EpC4bsocUq_LLbC0As05PFemN-TuhOHjPYrjmwLdAlhHw_McQG18L-EhsXrJXNe3V7XvzOMaHZ-_RaeXTlIEDiC4FMauI6xUQ/s320/PXL_20240527_063302869.jpg"/></a>
</div>
Converted to text:
<p>
<div class="tx">
<pre>
: cattermloop  begin
                    ser.?rxrdy if
                              @ser.char
                              demit
                    then
                    &lt;?k&gt; if
                              char char? off record dup
                              e1 = if
                                        leave
                              then
                              semit
                    then
          0 until ;
: cattermhi cls home ." CatTerm oldvcr.blogspot.com UNDO to quit" cr ;
: catterm edde if 0 40f884 ! -1 410078 ! cattermhi cattermloop 0 410078 ! -1 40f884 ! new-display else cattermhi cattermloop then ;
</pre>
</div>
<p>
(Now here’s a great advancement in open source: it comes with its own
source code as the document, preparsed into the dictionary and set to
autostart. You can even preview the code with USE FRONT-DISK and see
what code you’re about to run. Wanna change it? Change the code in the
editor and USE FRONT-ANSWER, and the words will be redefined and ready
to execute. Save it to disk, repatch the disk image, and make it your
own.)
<p>
The main loop in <tt>cattermloop</tt> bounces between checking if a
character is waiting at the serial port and if a keypress is pending. If
one is at the port, it reads it and prints it to the terminal at the
cursor position. If one is at the keyboard, it grabs it, stuffs it into
the LEARN buffer if appropriate, and then checks to see if it’s the UNDO
key (code $e1). If it is, it exits the loop.
<p>
<p>The word we’ll execute, however, is <tt>catterm</tt>. I decided to be
a little silly here to prove a point. The Cat can operate in various
modes, with the variable <tt>edde</tt> set to true if it’s in the editor
and <tt>crt</tt> set to true if it’s at the prompt. But these are just
memory locations, so you can either do <tt>edde on</tt> or <tt>-1 40f884
!</tt>, which references its address explicitly (yes, values are
signed). By forcing these modes, you can make text go different places.
We don’t want anything emitted to the document, so if we started
execution from the editor we turn the <tt>edde</tt> variable off and the
<tt>crt</tt> variable on, start the loop, and then set them back and
repaint the screen (otherwise we “just do it”). Properly written,
however, you can also just say <tt>edde on</tt> and <tt>crt off</tt>,
and vice versa.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhcuRCGVWuC6FhYZlBsyWL5QdYC16sWfpmyNgfWcuY8J36kC-fSQBb5axWvhUrMlN4FxYZygLCILEQag9fnN1i3t56nwMaSjnnEG7HRlzIIwrD8Ib8aoI8cuajVCBdJvs4Nr06nDyH58PCdyMhfOp9wD22RI58WuKMLgtbV5Z2Bn26znNlrD3kP79RHPFU/s4080/PXL_20240527_061208766.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhcuRCGVWuC6FhYZlBsyWL5QdYC16sWfpmyNgfWcuY8J36kC-fSQBb5axWvhUrMlN4FxYZygLCILEQag9fnN1i3t56nwMaSjnnEG7HRlzIIwrD8Ib8aoI8cuajVCBdJvs4Nr06nDyH58PCdyMhfOp9wD22RI58WuKMLgtbV5Z2Bn26znNlrD3kP79RHPFU/s320/PXL_20240527_061208766.jpg"/></a>
</div>
We highlight the entire text and do USE FRONT-ANSWER to define the
words, and then take a test drive with <tt>catterm</tt> from the
<tt>ok</tt> prompt. It works! Now we’ll grab the token value for
<tt>catterm</tt> and use that as a parameter to the patch utility. The
exact value will vary depending on what words were defined already, but
in this case, it’s $07e2.
<p>
<p>As a last convenience we enter and highlight the word
<tt>catterm</tt> in the document so that you can just run it again from
the editor by pressing USE FRONT-ANSWER. We save it to disk and create a
disk image, and patch it. Here it is booting. I couldn’t run to the
workstation and type at the same time as I was filming, but you can see
that it autostarts and cleanly returns to the editor. The CatTerm disk
image is
<a href="https://github.com/classilla/catbox/tree/main/examples/catterm">in
the Catbox</a>.</p>
<div class="separator" style="clear: both; text-align: center;">
<iframe allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" width="320" height="266" src="https://www.blogger.com/video.g?token=AD6v5dyb7VwicZBp750qw1fZnpruWvYcRVwJ0IJ4cnaskZdnIeD6CV7hgGc7Yi5z-XOvWYghad5eyyfNawJ0IivVdw" class="b-hbp-video b-uploaded" frameborder="0">
</iframe>
</div>
I also demonstrate running it from the <tt>ok</tt> prompt by pressing
SHIFT-USE FRONT-SPACE, entering <tt>page</tt>, entering
<tt>catterm</tt>, and after pressing UNDO entering <tt>re</tt> to return
to the editor. Everything works just as it should. Port speed and
settings are configured with SETUP, just like everywhere else.
<p>
But what if you don’t <em>want</em> to return to the editor?
<p>
<h3>
Hack No. 3: The First Canon Cat Demo?
</h3>
<p>
This might be where I become branded a heretic by the School of Raskin
for escaping the primary interface. But it’s a general purpose computer,
and we should be able to use it for general purpose computer things.
Plenty of stuff took over the Mac entirely, so I don’t see why the Cat
should be any different.
<p>
For this last hack, we’ll go all the way live and make a full-fledged
slideshow demo. I’ll select and convert some pictures as a love letter
to the 1980s office and we’ll have the Cat load them in sequence
directly from disk. When you exit the demo, it will cold-start the
machine back to the editor (so we’ll dub this a “cold booter”).
<p>
Our payload can now be shorter, because the words for setting up the
editor no longer need to be run. However, we still need to unpack the
document text, such as it is (we can overwrite it later if we want),
because it must be shifted up in RAM first to ensure the Forth
dictionary ends up in the right place. In addition, we need to set a
system flag to prevent screen repaints during that process or any title
screen we put on the disk will get obliterated.
<p>
After the <tt>doff</tt> at $2c91d, which turns off the disk drive, in
our cold booter payload I insert a <tt>showmove? off</tt> to ensure
<tt>unpacktext</tt> doesn’t try to repaint the screen. We’ll then do
everything up to, but stop short of, the <tt>setupcat</tt> at $2c947.
Instead, at that point we’ll push our token and end with <tt>execute
cold ;</tt> since we won’t be returning to the editor and we won’t try
to keep any of the system variables intact.
<p>
Now for the pictures. It will be simplest to segregate the slides to a
second disk which we can occupy the whole of. We’ll have the Cat format
it, then promptly overwrite it with our own data. The <tt>rtrk</tt> and
<tt>wtrk</tt> words will load or save an entire track of data (5120
bytes) to or from a given memory address, so we will have each picture
occupy 28896 bytes divided by 5120 bytes per track to equal 5.64375
tracks, i.e., six tracks apiece rounded up. This is a little inefficient
for the last portion of the display but we’re optimizing for speed here.
<p>
<p>If we’re going to ask for a new disk, we should do so with style, so
this will be our screenshot image. C’mon, he’s the original father of
the Mac too!</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg9ywXw2a2Jen1xNac5K9z673HLgAUOKJcZWgEDcY9s4LZiYXrKvgg-mzG_x4NeqdWVzc1rWVmWxHTzJdURRjOv0n95R8sFtoduIR4609MLwFsCaA-2R-59OApStgHTjrRyZY5PV8o_UyVZqZ8D39whevj3qGlO6NtjBzFw-EaOSLGMbqDY5LP1D9HK4ek/s672/blinkin.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEg9ywXw2a2Jen1xNac5K9z673HLgAUOKJcZWgEDcY9s4LZiYXrKvgg-mzG_x4NeqdWVzc1rWVmWxHTzJdURRjOv0n95R8sFtoduIR4609MLwFsCaA-2R-59OApStgHTjrRyZY5PV8o_UyVZqZ8D39whevj3qGlO6NtjBzFw-EaOSLGMbqDY5LP1D9HK4ek/s320/blinkin.png"/></a>
</div>
<p>We will blink the question mark until the disk is switched, as a
classic Mac would do, then draw the original
<a href="https://en.wikipedia.org/wiki/Macintosh_startup#Happy_Mac">Happy
Mac</a> over it and proceed with the slides. Here they are, largely
extracted from contemporary marketing material, then edited in Krita and
Floyd-Steinberg dithered with ImageMagick. Any blurriness in these grabs
is due to the upscaling I did to match the CRT aspect ratio; they are
sharp on the Cat.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgl30KqLXGEc4krUA05g7HTOmpUt_egUoEfKTKC_Mcsc0FNnMQSSHELzEeZ9gwfiUfQ61vez-I1lOJtGugTO2p6XAiN62okcnv_cFc-PiyQGL3f4-lAWE9angf03cmjOgG3_7N_XZcpSUyZR7WYBsK_F07Ly6BhqXZ6Y6Gg6znUbzUZxg7m85FTTy9HQ0o/s672/catmac.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgl30KqLXGEc4krUA05g7HTOmpUt_egUoEfKTKC_Mcsc0FNnMQSSHELzEeZ9gwfiUfQ61vez-I1lOJtGugTO2p6XAiN62okcnv_cFc-PiyQGL3f4-lAWE9angf03cmjOgG3_7N_XZcpSUyZR7WYBsK_F07Ly6BhqXZ6Y6Gg6znUbzUZxg7m85FTTy9HQ0o/s320/catmac.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh5V9ol4CBAOednJoPwBB4IUuKsJjcTBTJELiopJ8ofOImTwVpxaDrbaFOGHCEZDfiLcOfNULmnbA85jcyWFKKuiieIG_1zSTsPxurxNi4b6JvzHH95Vr40It6REoNoa5psvVOAXCXWiBoT8t8giR5VC0vQ4pOH184XSzUeE4TjsdAxx60pG7AGzXsRo-w/s672/catcat.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEh5V9ol4CBAOednJoPwBB4IUuKsJjcTBTJELiopJ8ofOImTwVpxaDrbaFOGHCEZDfiLcOfNULmnbA85jcyWFKKuiieIG_1zSTsPxurxNi4b6JvzHH95Vr40It6REoNoa5psvVOAXCXWiBoT8t8giR5VC0vQ4pOH184XSzUeE4TjsdAxx60pG7AGzXsRo-w/s320/catcat.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgafa9b5_WxXXXRkZ9S4w6TUCSbLrW_9x2lj_tTePwgDodiIYBjDksbfVTfRlqViejx1j6NEmqA2QHigw29W7BvtrhSNHf33jHrZGIcudfzwZqYPSYvm1Yip_jiaKP5wiGdYKaRjxUU1L8jPx55pPZ5S07HoN1OdLoBMtslFuSZYNMiVylEfOn_8suhNXk/s672/catcat2.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgafa9b5_WxXXXRkZ9S4w6TUCSbLrW_9x2lj_tTePwgDodiIYBjDksbfVTfRlqViejx1j6NEmqA2QHigw29W7BvtrhSNHf33jHrZGIcudfzwZqYPSYvm1Yip_jiaKP5wiGdYKaRjxUU1L8jPx55pPZ5S07HoN1OdLoBMtslFuSZYNMiVylEfOn_8suhNXk/s320/catcat2.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgnT8v3dVSdQgZQlDlFqO6XuU2io5x1hpzuQmA_Xj4bEd3lHfiBRSMklxuBXXdw7LkyRDOMZnmmYg3_QH3bAdm5yOZJPYOyY3a3UZPRhpScnXBMSMmkG3bD-akWfqBs8LH_tt6XaeRMmVi6UGbOsPEb6wbIf8fe7lLBu7OL9i4P8wKLMGFlR115Rx_cEFU/s672/catday.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgnT8v3dVSdQgZQlDlFqO6XuU2io5x1hpzuQmA_Xj4bEd3lHfiBRSMklxuBXXdw7LkyRDOMZnmmYg3_QH3bAdm5yOZJPYOyY3a3UZPRhpScnXBMSMmkG3bD-akWfqBs8LH_tt6XaeRMmVi6UGbOsPEb6wbIf8fe7lLBu7OL9i4P8wKLMGFlR115Rx_cEFU/s320/catday.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjeRYmUOcZw6nebBovvdhGBGlEt9kIDM59Gih1193xqQ2Qc2oTgW9Z679bskGVn8rUPMWKFTH0uz7IXo7gFTOe4pg-MYS138c8xPdgQgZmLt8posCb_iHQHHjbru7bnEJltKfNSPa7G8choRS0X9P9cxDvlHId4wBkSA0DXYpv4qP7r2ZmahAseMbDm6aY/s672/cattype.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjeRYmUOcZw6nebBovvdhGBGlEt9kIDM59Gih1193xqQ2Qc2oTgW9Z679bskGVn8rUPMWKFTH0uz7IXo7gFTOe4pg-MYS138c8xPdgQgZmLt8posCb_iHQHHjbru7bnEJltKfNSPa7G8choRS0X9P9cxDvlHId4wBkSA0DXYpv4qP7r2ZmahAseMbDm6aY/s320/cattype.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj8qYtP936Moa42YpoOCVrfL4PC_fPmY9teyykMgqTtPnxs9QJ_8AnMZd-bb1CRRxNFfno2QeEbM9pNrFN-vYCHCcIEt1cl7WFGtIzU6pkhnQ3qRnfa_Zw5cPQilSuWfECqDOt82fU5WjZ2iLtGW5-ni1x0rPuQcxeKnt23hYtHHT6GLdPLctzVSyCqaiM/s672/raskinbw.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEj8qYtP936Moa42YpoOCVrfL4PC_fPmY9teyykMgqTtPnxs9QJ_8AnMZd-bb1CRRxNFfno2QeEbM9pNrFN-vYCHCcIEt1cl7WFGtIzU6pkhnQ3qRnfa_Zw5cPQilSuWfECqDOt82fU5WjZ2iLtGW5-ni1x0rPuQcxeKnt23hYtHHT6GLdPLctzVSyCqaiM/s320/raskinbw.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJxNdI8CDR6iwnWNEocCqdDo0nW3mGBEvgb-IF2uv1GUmyhyphenhyphenmi1_siX_0_RTlXyOB1ex_x4BJFhBUDDjtBRZhraOgAoxPXvNGG8-Op8SZ7hsir4cRSYblVqHxjIvBI4oLIrYXBeB4CCyqGC9i9zrFzrk7FCXA6WoWrpdxKDQR2xk30cMuLgOdgofsSmeQ/s672/catoffice.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEiJxNdI8CDR6iwnWNEocCqdDo0nW3mGBEvgb-IF2uv1GUmyhyphenhyphenmi1_siX_0_RTlXyOB1ex_x4BJFhBUDDjtBRZhraOgAoxPXvNGG8-Op8SZ7hsir4cRSYblVqHxjIvBI4oLIrYXBeB4CCyqGC9i9zrFzrk7FCXA6WoWrpdxKDQR2xk30cMuLgOdgofsSmeQ/s320/catoffice.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEieIaZpV61ZQYZkfCE_2UgykcqS5WP8681rpJktanUWAqBm693IJhSh8VuUldSwnVjQeiXR21gVqnGZ2ZrnzmnQ1hM_nqsXdXIhROKNFlMUFKreSVdtINq0UaOLJLCxTOhJ1kjmJEXuX2B9h2SFJJR5B4_EwmcQZlPSdlX5Go31MWWNizlkIub1LH_gCVA/s672/catdesk.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEieIaZpV61ZQYZkfCE_2UgykcqS5WP8681rpJktanUWAqBm693IJhSh8VuUldSwnVjQeiXR21gVqnGZ2ZrnzmnQ1hM_nqsXdXIhROKNFlMUFKreSVdtINq0UaOLJLCxTOhJ1kjmJEXuX2B9h2SFJJR5B4_EwmcQZlPSdlX5Go31MWWNizlkIub1LH_gCVA/s320/catdesk.png"/></a>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgjc6JkStzrdKQP-xsar9dfXf8oT2QcdAE6SQCeidchTxGRNy3XAUeVd3hZ_aUMqiustBDq6cg16uBnZaKGXq_29xPF6PlVW9VRWIPj7yMaUcKOFQapDcxBRjc-ITH_6sMUvuy0tLz2a-D_2dl53zPZZSx2fpr6MlQyqbykp4gLA-QwgyeHX9KNvQRjI2A/s672/catbuy.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgjc6JkStzrdKQP-xsar9dfXf8oT2QcdAE6SQCeidchTxGRNy3XAUeVd3hZ_aUMqiustBDq6cg16uBnZaKGXq_29xPF6PlVW9VRWIPj7yMaUcKOFQapDcxBRjc-ITH_6sMUvuy0tLz2a-D_2dl53zPZZSx2fpr6MlQyqbykp4gLA-QwgyeHX9KNvQRjI2A/s320/catbuy.png"/></a>
</div>
<p>For the credits screen, I typed it into the editor and saved it to
another disk.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhyq24HWmizezUmLQndXG_akddJRq9s9ShBqVKz5GUlkjANaZsYNKZH7pBxM0Olr4EKp-O2y_qbU5PbUi7QASDFZagMvG95KT6VhH8Q4pUBUT_l75hPy2Q8oE5HfDbe3nfRpBmEv5dKhu-yQDXOwXV-nMRmlSO8d3PcOPTruXefZLQS3-P7iQz5_njTvew/s672/catdtxt.png" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="504" data-original-width="672" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhyq24HWmizezUmLQndXG_akddJRq9s9ShBqVKz5GUlkjANaZsYNKZH7pBxM0Olr4EKp-O2y_qbU5PbUi7QASDFZagMvG95KT6VhH8Q4pUBUT_l75hPy2Q8oE5HfDbe3nfRpBmEv5dKhu-yQDXOwXV-nMRmlSO8d3PcOPTruXefZLQS3-P7iQz5_njTvew/s320/catdtxt.png"/></a>
</div>
I then used <tt>catrpic</tt> from the first hack to extract it and added
it to the pile as the final image.
<p>
To create the slides, after having the Cat format a blank disk, we’ll
transmit the bitmap data via the serial port. This is binary safe
<em>if</em> we disable XON/XOFF first, or otherwise the Cat will
intercept and act on those characters. For example, this snippet at the
<tt>ok</tt> prompt will wait for data from the serial port and read
28896 bytes from it, spewing them to the screen directly. We assume your
serial port is still configured for “SEND Command/Full Duplex” at
9600bps, 8-N-1.
<p>
<div class="tx">
<pre>
ser.xon.tx.off page 4070e0 400000 do ser.rx i c! loop key drop
</pre>
</div>
<p>
Then send the 28896-byte raw bitmap data (in our case, the scaled and
dithered PBM with the PBM header removed) with something like
<tt>sendfile /dev/ttyUSB0 9600 image.cat</tt> — no intercharacter delay
is necessary as this loop will have no problem keeping up. Note that we
use <tt>ser.xon.tx.off</tt> to disable acting on <em>received</em>
XON/XOFF characters, but actually fetch characters with <tt>ser.rx</tt>
(which will wait for a byte to be ready). Once all bytes are loaded, it
will wait for a key, and then stop.
<p>
<p>We’ll test it <s>on Captain Solo</s> by writing out a track and
trying to read it back.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhF3B6CiEahNrT8_805Xy-y2O7b1mchEt_7Im7GIkuItNVex2SfY-qUtQMjyY0yIiV2oZSNvu4WQMF7sD0V9nx-KuZHe9i1PPtCbouBaaor7yzrWKICSPGpFdoHcRbLHzALLu0MZke21oA1NOIzNvRKpaWLF4qrP7sSPjWCuF-VfQcTAmiymri8h-07GQM/s4080/PXL_20240602_013548401.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEhF3B6CiEahNrT8_805Xy-y2O7b1mchEt_7Im7GIkuItNVex2SfY-qUtQMjyY0yIiV2oZSNvu4WQMF7sD0V9nx-KuZHe9i1PPtCbouBaaor7yzrWKICSPGpFdoHcRbLHzALLu0MZke21oA1NOIzNvRKpaWLF4qrP7sSPjWCuF-VfQcTAmiymri8h-07GQM/s320/PXL_20240602_013548401.jpg"/></a>
</div>
Converted to text,
<p>
<div class="tx">
<pre>
ser.xon.tx.off
4070e0 400000 do ser.rx i c! loop 400000 0 wtrk 401400 1 wtrk 402800 2 wtrk 403c00 3 wtrk 405000 4 wtrk 405ce0 5 wtrk . . . . . .
</pre>
</div>
<p>
We turn off XON/XOFF for receive, load the image, then write out six
tracks at the given addresses (5 overlaps slightly with 4). The six dots
at the end report out the status of each track write with <tt>wtrk</tt>.
<p>
<p>Don’t get those arguments transposed to these track read/write
routines, by the way. The operating system <em>will</em> try to seek to
track 4194304, causing the head to repeatedly hit the outside rail and
possibly damage itself! There is no bounds checking on these
routines!</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNXIEA2XPhNZ1uoJrggOqlJmIzWdTmOMahQ5XGL2VZ3lwtu8X2Ihl66MBXpaGaICjUQPoCi8AEa-I5oPWjdPEsjFSWB1L9Ss0JrzDGiCwVoM2IMhd2JKsEo51uhVuHoLK3t87bCOvJE_KfWOHbbbtC_gnYeHl7-0P4jiBvYrLhlRpUwwdxHbuitdynkAI/s4080/PXL_20240602_013637401.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjNXIEA2XPhNZ1uoJrggOqlJmIzWdTmOMahQ5XGL2VZ3lwtu8X2Ihl66MBXpaGaICjUQPoCi8AEa-I5oPWjdPEsjFSWB1L9Ss0JrzDGiCwVoM2IMhd2JKsEo51uhVuHoLK3t87bCOvJE_KfWOHbbbtC_gnYeHl7-0P4jiBvYrLhlRpUwwdxHbuitdynkAI/s320/PXL_20240602_013637401.jpg"/></a>
</div>
<p>Receiving and writing the test image.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZoX0r5RokxQSuWczhDt_qKP7OH-JX7MrG2cGzwmoOYz4Ca586re1ZeDPQfrg_rbZEEFx6qEjyS4Y9vj06v1yAe_7VGlOTjTo57qfZUntQkECglfq_jFXHBw9SrKoI8IIZYSa3frwcRzy9i833zAiu3WKwlIkEnQUGDag-XoYNV1-kZa0EwOalWWZ_eyw/s4080/PXL_20240602_013802022.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZoX0r5RokxQSuWczhDt_qKP7OH-JX7MrG2cGzwmoOYz4Ca586re1ZeDPQfrg_rbZEEFx6qEjyS4Y9vj06v1yAe_7VGlOTjTo57qfZUntQkECglfq_jFXHBw9SrKoI8IIZYSa3frwcRzy9i833zAiu3WKwlIkEnQUGDag-XoYNV1-kZa0EwOalWWZ_eyw/s320/PXL_20240602_013802022.jpg"/></a>
</div>
Now for the other direction, which is quite logically the reverse with
<tt>rtrk</tt>.
<p>
<div class="tx">
<pre>
400000 0 rtrk 401400 1 rtrk 402800 2 rtrk 403c00 3 rtrk 405000 4 rtrk 405ce0 5 wtrk key drop . . . . . .
</pre>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgStSHK2uYwWxgdGwx3XLjBU3kDS3FArj98pDvZHaIrLw0pPE4H4k6JigrLPrenPDDMKvr8pyp9WYb9gm6a_k8l0y8enBgsqZWEZz7AmR4ixMqb-CSfipqDvcaBdiqbwJGQSP-gE6jrKf1ajthQ0eBHfbXtuHE3Gg7fYPdem8PVNKLQQrU9rz1RF-vWeI8/s4080/PXL_20240602_013827636.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEgStSHK2uYwWxgdGwx3XLjBU3kDS3FArj98pDvZHaIrLw0pPE4H4k6JigrLPrenPDDMKvr8pyp9WYb9gm6a_k8l0y8enBgsqZWEZz7AmR4ixMqb-CSfipqDvcaBdiqbwJGQSP-gE6jrKf1ajthQ0eBHfbXtuHE3Gg7fYPdem8PVNKLQQrU9rz1RF-vWeI8/s320/PXL_20240602_013827636.jpg"/></a>
</div>
<p>The image reappears from the floppy.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZJgXjN35U06UF4NwHepeUzSEmMaJK761ZViBO63OQA3xl7HKXqdnSqsKRLFrafGK4GjwEDYnJqHTDZff102RjQbTAuazOUONL4Kk5d1kC6YLnZqgj2tYkNiHiI_L2QQOuVpkLERxwNCkkHe9T2zB3KhWBAhjhQWTD0JOpv0ly_JJRFsITV9b6UyOJY-E/s4080/PXL_20240602_053605784.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEjZJgXjN35U06UF4NwHepeUzSEmMaJK761ZViBO63OQA3xl7HKXqdnSqsKRLFrafGK4GjwEDYnJqHTDZff102RjQbTAuazOUONL4Kk5d1kC6YLnZqgj2tYkNiHiI_L2QQOuVpkLERxwNCkkHe9T2zB3KhWBAhjhQWTD0JOpv0ly_JJRFsITV9b6UyOJY-E/s320/PXL_20240602_053605784.jpg"/></a>
</div>
Now with a successful test, we will create the disk with this small
program. The return values from <tt>wtrk</tt> are just left on the stack
since we’ll be cold booting it after anyway to set up the main code
word. XON/XOFF is already (x)off.
<p>
<div class="tx">
<pre>
3c 0 do 4070e0 400000 do ser.rx i c! loop 400000 i wtrk 401400 i 1 + wtrk 402800 i 2 + wtrk 403c00 i 3 + wtrk 40500 i 4 + wtrk 405ce0 i 5 + wtrk 6 +loop
</pre>
</div>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitjBE601dRMzYiYeYq9MvvlowqLfrrXGKY81qmUq8F2TSNYTRFXMEcvNbTjUo-G4gmWs9yrNo3ticwA_bR95Bg1rJe10vm7O7hoPXeqmDGh8714ilAE4zDfJ9QphFO5UDyN5S4-7HbqbkWVRfFzyy3bMLoLd2KMSdzi-1-DTAe1xfl8bcqbF2WJIdlJPw/s4080/PXL_20240602_053810877.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEitjBE601dRMzYiYeYq9MvvlowqLfrrXGKY81qmUq8F2TSNYTRFXMEcvNbTjUo-G4gmWs9yrNo3ticwA_bR95Bg1rJe10vm7O7hoPXeqmDGh8714ilAE4zDfJ9QphFO5UDyN5S4-7HbqbkWVRfFzyy3bMLoLd2KMSdzi-1-DTAe1xfl8bcqbF2WJIdlJPw/s320/PXL_20240602_053810877.jpg"/></a>
</div>
<p>Leaving the blinking disk screen for the boot disk, we transmit each
bitmap from the Linux workstation using <tt>sendfile</tt>. When all the
bytes have been received, the Cat will write it to disk and come back
for the next, and so on until all the images are sent.</p>
<div class="separator" style="clear: both;">
<a href="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3Njajx-hqT9WsTbxNDcTg46Jgp5Rywveu7cKtm7K2s2IhP2PCh8V6-drhsjPwS8jwTPYVW-GbWZ-iFrs8bktsnLGuDkR7JF5-eu1wCTqpELotUgx3SpWA9FE4CGAuWfvAobPRN2lLAb9nxupJG5bGEornfhXsJJM145irp8fiatG9fRrBvH1Kxl_LM5w/s4080/PXL_20240602_022033640.jpg" style="display: block; padding: 1em 0; text-align: center; "><img alt="" border="0" width="320" data-original-height="3072" data-original-width="4080" src="https://blogger.googleusercontent.com/img/b/R29vZ2xl/AVvXsEi3Njajx-hqT9WsTbxNDcTg46Jgp5Rywveu7cKtm7K2s2IhP2PCh8V6-drhsjPwS8jwTPYVW-GbWZ-iFrs8bktsnLGuDkR7JF5-eu1wCTqpELotUgx3SpWA9FE4CGAuWfvAobPRN2lLAb9nxupJG5bGEornfhXsJJM145irp8fiatG9fRrBvH1Kxl_LM5w/s320/PXL_20240602_022033640.jpg"/></a>
</div>
Unlike every other graphic image in the demo, however, we’ll draw the
Happy Mac from an internal set of bitmap values instead of trying to
fetch it from disk as well. Here I’m messing with the positioning to
determine the best addresses to blink the question mark and where
onscreen the Happy Mac should be loaded. Eventually I settled on the
following, which is the entirety of the demo source code in Forth:
<p>
<div class="tx">
<pre>
( wait for a key )
: keywait ( delay - key )
        0 swap
        0 do
                drop
                &lt;?k&gt; if 
                        char char? off leave
                then
                1 ms
                0
        loop ;

( wait until the disk is out )
: diskwaitout ( delay - flag )
        0 swap
        0 do
                drop
                ?diskrdy not dup if
                        leave
                then
                1 ms
        loop doff ;

( wait until the disk is in )
: diskwaitin ( delay - flag )
        0 swap
        0 do
                drop
                ?diskrdy dup if
                        leave
                then
                1 ms
        loop doff ;

( general disk wait loop )
: diskwait ( waitword )
        begin
                ( erase question mark )
                403cdd 4038ed do ffff i w! 54 +loop
                ( ensure drive is on, needs a delay )
                drive0 40 800000 or! 180 ms
                dup 0500 swap execute if drop leave then

                ( draw question mark - bitmap data is lifo )
                fe7f fe7f ffff fe7f fe7f fe3f ff1f ff8f f3cf f3cf f00f f81f
                        403cdd 4038ed do i w! 54 +loop
                drive0 40 800000 or! 180 ms
                dup 0500 swap execute if drop leave then
        0 until doff ;

( display a picture stored on disk at a particular track number )
: trackpic ( track - )
        ( each picture is six tracks long with overlap in the last track )
        dup
        400000 swap rtrk drop
        dup 1 +
        401400 swap rtrk drop
        dup 2 +
        402800 swap rtrk drop
        dup 3 +
        403c00 swap rtrk drop
        dup 4 +
        405000 swap rtrk drop
        5 +
        405ce0 swap rtrk drop
        ( wait for a keypress for 2560 ticks or reset if UNDO pressed )
        0a00 keywait e1 = if cold then
        ;

( main loop )
: slideshow ( - )
        ( turn off editor )
        edde off crt on

        ( mac gimme disk screen is already encoded in the screenshot )
        ['] diskwaitout diskwait
        ['] diskwaitin diskwait

        ( make sure we can read track 0 )
        recal 0 &lt;&gt; if
                page ." disk read failure"
                1000 keywait drop cold
        then

        ( draw 32x32 happy mac and erase bottom of floppy disk icon )
        aaaaaaaa 50000015 a7ffffca 57ffffd5 a7ffffca 50000015 afffffea 4fffffe5 afffffea 4fffffe5 acffc0ea 4fffffe5 afffffea 4fffffe5 afffffea 4e0000e5 adffff6a 4dffff65 adf87f6a 4df7bf65 adffff6a 4dfcff65 adfeff6a 4dfeff65 adeeef6a 4deeef65 adffff6a 4dffff65 adffff6a 4e0000e5 afffffea 57ffffd5 a800002a
                403dd8 403304 do i ! 54 +loop

        ( shocked mac slide, then loop the rest of the slideshow )
        400 ms 10 keywait drop ( prime key events ) 0 trackpic begin
                0a ( number of pictures, then multiplied by tracks per pic )
                6 * 6 do i trackpic 6 +loop ( each picture is six tracks )
        0 until ;

( shamelessness )
: credits ." copyright 2024 cameron kaiser" cr ;
</pre>
</div>
<p>
This is all pushed over the serial link and parsed into words on the Cat
using the same process as before.
<p>
The main code starts with <tt>slideshow</tt> where we first make sure
all updates go direct to the screen. After that, the <tt>diskwait</tt>
word is what waits for the state changes of the floppy. It has its own
routines for erasing and redrawing the blinking question mark. This word
takes the token of another word as an argument which it calls to
determine whether the desired condition is satisfied, so we call it
first with <tt>diskwaitout</tt> to wait for the first disk to be
removed, then <tt>diskwaitin</tt> to wait for the second disk to be
inserted. These words directly manipulate the floppy drive through Gate
Array #3 by briefly turning it on to check for the disk, then waiting
for a settling period after the motor starts to get the disk status
back. The question mark is encoded as a series of literal words pushed
onto the stack in reverse order so they get pulled off in the right
order for the loop.
<p>
With the next disk in, the <tt>recal</tt> word seeks for track zero and
returns 0 for success or an error code for failure. Assuming it can find
it, it draws the Happy Mac (with whole 32-bit words this time but using
the same principle), primes the keyboard, and starts with the first
picture, the Shocked Mac. The <tt>trackpic</tt> word loads the six-track
image and waits for a keypress in a given timeframe, cold-starting the
Cat if the UNDO key is pressed. The cold start process will of course
try to read the disk, but it won’t be recognized as a Cat floppy and
will be ignored, thus putting the user back into the editor.
<p>
This does give the floppy drive quite a workout. You’ll notice that the
Shocked Mac appears only the very first time it boots and never in the
loop after that, and it’s because I think my floppy drive has a marginal
track zero switch (at the age these drives are, I suspect other
otherwise-working Cat drives have a similar problem). This switch
appears to be mechanical on the Canon drive rather than the more typical
LED/sensor combination. More times than not this particular disk drive
could get back to track zero, but sometimes it wouldn’t, which explains
why some of my reads from disks the Cat wrote started on physical track
two even though the Cat’s firmware obviously believed it was writing
track zero. It doesn’t seem like an alignment problem with the switch or
the drive because when it <em>does</em> find track zero, it reads disks
written by the Teac (our “perfectly aligned” brand spanking new floppy
drive) just fine, and obviously it’s also able to write track zero more
often than not or this demo might not have been possible.
<p>
Accordingly, the problem I ran into with this hack was the drive
couldn’t reliably get back to track zero after the last picture either
(it’s over 60 tracks away by then). If this happens to you in the
editor, you can just try reading the disk again until it “gets it.” But
here <tt>rtrk</tt> will pause waiting patiently for the correct track to
come by, which probably won’t happen for the good minute or so it waits
until it times out. Trying to manually step the head back in track by
track didn’t really help. The best solution was just to start back over
on track 6 instead of track 0, and that seemed to work generally okay,
though this is probably not a demo you want to leave running repeatedly
on the Cat regardless.
<p>
<p>Here’s the finished product. Both disk images are
<a href="https://github.com/classilla/catbox/tree/main/examples/slideshow">in
the Catbox</a>.</p>
<div class="separator" style="clear: both; text-align: center;">
<iframe allowfullscreen="allowfullscreen" webkitallowfullscreen="webkitallowfullscreen" mozallowfullscreen="mozallowfullscreen" width="320" height="266" src="https://www.blogger.com/video.g?token=AD6v5dyhVFVE0tMkJSdx9aP9nMFbtTrK3ec892uzUmk4ERrU---d9ZU2oqDqoYvw8lvtD23_shgckxh2PN1tkaU0NA" class="b-hbp-video b-uploaded" frameborder="0">
</iframe>
</div>
This hack brings you the final iteration of
<a href="https://github.com/classilla/catbox/blob/main/catcpic"><tt>catcpic</tt></a>,
which now is a three-headed application. It requires your original eDSK
and a properly formatted and inverted PBM, generates a nice randomized
idtable so that your Cat can’t confuse it with anything else (though you
can pass it one in hex with <tt>-idtable=…</tt> if you want) and emits
the resulting disk image to standard output. If you don’t pass it a
token in hex, it will install the “press any key” patch; if you do, and
you specify <tt>-cold</tt>, you’ll get a cold booter; otherwise you’ll
get a autostarter that will enable you to cleanly return to the editor.
<p>
To compensate for the situation where your Cat’s drive might also be
acting up and not truly writing to track zero either, I’ve also included
<a href="https://github.com/classilla/catbox/blob/main/optedsk">an eDSK
optimizer tool</a>. It will remove and properly relocate unformatted
tracks, or even formatted tracks before the detected idtrack if you use
<tt>-force</tt>, adjusting the eDSK DIB and TIBs and emitting the
corrected disk image to standard output. You can also just say
<tt>-test</tt> to see what it thinks about a particular image (<tt>-test
-force</tt> will make it continue even if it doesn’t think the disk is a
Cat disk).
<p>
<h3>
Things to do
</h3>
<p>
Some considerations for <a href="/search/label/canon">a future
entry</a>:
<p>
<ul>
<li>
Figure out how to lash something like a Gotek floppy emulator to the Cat
because I’m not sure how much more life this disk drive’s got in it. The
idea should be along the lines of building one of the adapters that let
you use a PC floppy drive, but then plug an emulator into it instead.
<li>
Fix for v2.4x ROMs, which some Cat enthusiasts run now, but that would
require me to modify my Cat to do so, which I’m not entirely willing to
do without a good reason. I’ll take patches, though.
<li>
A proper set of games for the Cat. How about a text adventure played in
the editor?
<li>
Audio demo? The <tt>tone</tt> and related words for playing audio tones
documented in the tForth manual are not in the 1.74 ROM. There is a
<tt>beep</tt> word which twiddles with the DUART, but it’s not clear if
it only beeps or can be made to play other tones.
<li>
uCLinux? If a Palm Pilot can run it …
<li>
Write shorter blog posts? (Nah.)
</ul>
<p>
<p>Everything in this blog post
<a href="https://github.com/classilla/catbox">is on Github</a> under the
BSD 3-clause license.</p>
<p><a
href="https://oldvcr.blogspot.com/2024/07/pretty-pictures-bootable-floppy-disks.html"
class="uri">https://oldvcr.blogspot.com/2024/07/pretty-pictures-bootable-floppy-disks.html</a></p>
</section>
<footer>
Antenna is a personal aggregation of items found around the web.
Curated with <a href="https://rsdoiel.github.io/skimmer">skimmer</a> and <a href="https://sqlite.org">sqlite</a> then rendered with <a href="https://pandoc.org">Pandoc</a> with search provided by <a href="https://pagefind.app">PageFind</a>.
</footer>
<script type="module">
    await import('/pagefind/pagefind-highlight.js');
    new PagefindHighlight({ highlightParam: "highlight" });
</script>
</body>
</html>
